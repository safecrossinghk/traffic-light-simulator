<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>å³æ™‚äººæµï¼ˆpopular_timesï¼‰</title>
<style>
body { font-family: sans-serif; margin: 1em; background: #f9f9f9; }
.location { padding: 1em; margin-bottom: 1em; background: #fff; border: 1px solid #ccc; border-radius: 8px; }
h2 { font-size: 1.2em; margin: 0 0 0.5em 0; }
.value { font-weight: bold; color: #006400; }
</style>
</head>
<body>
<h1>ğŸ“ å³æ™‚äººæµï¼ˆpopular_timesï¼‰æŸ¥è©¢</h1>
<div id="results">è¼‰å…¥ä¸­...</div>

<script>
const apiKey = 'MWE3NWNmMzFjZWNiNGMxMDlhNGNhNDFjNTY3ZjZkMTB8NzY5ZGY0MGQ0Zg';
const places = [
{ name: 'èƒç£è¥¿ç«™', query: 'Tsuen Wan West Station, Hong Kong' },
{ name: 'æ—ºè§’æœ—è±ªåŠ', query: 'Langham Place Mong Kok, Hong Kong' },
{ name: 'æ·±æ°´åŸ—åœ°éµç«™', query: 'Sham Shui Po MTR Station, Hong Kong' },
{ name: 'å°–æ²™å’€æµ·æ¸¯åŸ', query: 'Harbour City Tsim Sha Tsui, Hong Kong' },
{ name: 'ä¸­ç’°äº¤æ˜“å»£å ´', query: 'Exchange Square Central, Hong Kong' }
];

async function fetchPopularTimes() {
const resultsDiv = document.getElementById('results');
resultsDiv.innerHTML = ''; // æ¸…ç©ºå…§å®¹

for (const place of places) {
const url = `https://api.app.outscraper.com/maps/places/data?query=${encodeURIComponent(place.query)}&limit=1&language=en&fields=popular_times`;

const container = document.createElement('div');
container.className = 'location';
container.innerHTML = `<h2>${place.name}</h2><p>è¼‰å…¥ä¸­...</p>`;
resultsDiv.appendChild(container);

try {
const response = await fetch(url, {
headers: {
'X-API-KEY': apiKey,
'accept': 'application/json'
}
});

const json = await response.json();
const item = json[0];

const now = new Date();
const weekday = now.getDay(); // 0 = Sunday
const hour = now.getHours();

let popular = null;
if (item && item.popular_times && item.popular_times[weekday]) {
popular = item.popular_times[weekday].data?.[hour] ?? null;
}

if (popular !== null) {
container.innerHTML = `
<h2>${place.name}</h2>
<p>ç›®å‰äººæµï¼š<span class="value">${popular}%</span></p>
`;
speak(`${place.name}ï¼Œç¾æ™‚äººæµå¤§ç´„ ${popular} ç™¾åˆ†æ¯”ã€‚`, 'zh-HK');
speak(`${place.query}, current crowd level is ${popular} percent.`, 'en-US');
} else {
container.innerHTML = `
<h2>${place.name}</h2>
<p><span class="value">ç„¡è³‡æ–™</span></p>
`;
speak(`${place.name} æš«æ™‚æœªæœ‰äººæµè³‡æ–™ã€‚`, 'zh-HK');
}

} catch (err) {
console.error('Fetch error for', place.name, err);
container.innerHTML = `
<h2>${place.name}</h2>
<p><span class="value">æŸ¥è©¢å¤±æ•—</span></p>
`;
}
}
}

function speak(text, lang = 'zh-HK') {
if (!window.speechSynthesis) return;
const utter = new SpeechSynthesisUtterance(text);
utter.lang = lang;
utter.rate = 1;
window.speechSynthesis.speak(utter);
}

fetchPopularTimes();
setInterval(fetchPopularTimes, 5 * 60 * 1000);
</script>
</body>
</html>