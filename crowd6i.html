<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>ğŸ“ å³æ™‚äººæµæŸ¥è©¢ï¼ˆäº”å€‹åœ°é»ï¼‰</title>
<style>
body { font-family: Arial, sans-serif; background: #fff; padding: 20px; }
h2 { color: #b30000; }
.place { margin-bottom: 20px; }
.status { font-weight: bold; }
.low { color: green; }
.medium { color: orange; }
.high { color: red; }
.error { color: darkred; }
</style>
</head>
<body>
<h2>ğŸ“ å³æ™‚äººæµæŸ¥è©¢ï¼ˆäº”å€‹åœ°é»ï¼‰</h2>
<div id="results"></div>

<script>
const places = [
"èƒç£è¥¿ç«™",
"æ—ºè§’æœ—è±ªåŠ",
"æ·±æ°´åŸ—åœ°éµç«™",
"å°–æ²™å’€æµ·æ¸¯åŸ",
"ä¸­ç’°äº¤æ˜“å»£å ´"
];

const apiKey = "MWE3NWNmMzFjZWNiNGMxMDlhNGNhNDFjNTY3ZjZkMTB8NzY5ZGY0MGQ0Zg";
const fallbackToId = false; // å¦‚æœåç¨±æŸ¥è©¢å¤±æ•—æ˜¯å¦ä½¿ç”¨ maps_id fallback

const resultDiv = document.getElementById("results");

function classifyCrowdLevel(percent) {
if (percent < 40) return { label: "ç–è½", class: "low" };
if (percent < 70) return { label: "æ­£å¸¸", class: "medium" };
return { label: "æ“æ“ ", class: "high" };
}

async function fetchCrowd(place, retries = 3) {
const url = `https://api.app.outscraper.com/maps/search-v2?query=${encodeURIComponent(place)}&lang=zh&limit=1`;

try {
const res = await fetch(url, {
headers: { "X-API-KEY": apiKey }
});

const data = await res.json();

const loc = data.results_locations?.[0];
const crowd = loc?.popular_times?.[new Date().getDay()]?.data?.[new Date().getHours()];
return (typeof crowd === "number") ? crowd : null;

} catch (e) {
if (retries > 0) {
return await fetchCrowd(place, retries - 1);
} else {
return null;
}
}
}

async function showAll() {
for (const place of places) {
const container = document.createElement("div");
container.className = "place";
const title = document.createElement("div");
title.innerText = place;
const status = document.createElement("div");
status.className = "status";
container.appendChild(title);
container.appendChild(status);
resultDiv.appendChild(container);

const value = await fetchCrowd(place);
if (value !== null) {
const { label, class: className } = classifyCrowdLevel(value);
status.innerHTML = `ç›®å‰äººæµï¼š<span class="${className}">${label}</span>`;
} else {
status.innerHTML = `âš ï¸ <span class="error">æ­¤åœ°é»æš«ç„¡äººæµè³‡æ–™</span>`;
}
}
}

showAll();
</script>
</body>
</html>