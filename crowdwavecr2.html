<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>è”æè§’äººæµ + Waze åœ°åœ–</title>
<style>
body { font-family: sans-serif; text-align: center; margin: 0; padding: 0; }
iframe { width: 100%; height: 400px; border: none; }
.status { font-size: 1.5em; margin: 20px; }
button { margin: 5px; padding: 10px 20px; font-size: 1em; }
</style>
</head>
<body>
<h2>ğŸ“ è”æè§’å¯¦æ™‚äººæµ + Waze åœ°åœ–</h2>
<div>
<button onclick="loadLocation('Lai Chi Kok Station Exit A', 22.3378, 114.1472)">è”æè§’ç«™</button>
<button onclick="loadLocation('D2 Place Lai Chi Kok', 22.3376, 114.1483)">D2 Place</button>
<button onclick="loadLocation('Cheung Sha Wan Plaza', 22.3379, 114.1518)">é•·æ²™ç£å»£å ´</button>
<button onclick="loadLocation('D2 Place Two Lai Chi Kok', 22.3389, 114.1493)">D2 Place Two</button>
<button onclick="loadLocation('æ³“æ™¯åŒ¯', 22.338, 114.15)">æ³“æ™¯åŒ¯</button>
</div>

<iframe id="waze" src=""></iframe>
<div class="status" id="status">è«‹é¸æ“‡åœ°é»</div>

<script>
async function loadLocation(query, lat, lon) {
document.getElementById('status').textContent = "è¼‰å…¥ä¸­...";

// é¡¯ç¤ºåœ°åœ–ï¼ˆç§»é™¤ &q= åƒæ•¸ä»¥é˜² 400 éŒ¯ï¼‰
document.getElementById('waze').src = `https://embed.waze.com/iframe?zoom=17&lat=${lat}&lon=${lon}`;

try {
const response = await fetch(`https://crowdwavec.ctakwah.workers.dev/?q=${encodeURIComponent(query)}`);
const data = await response.json();

if (!data || !data.popular_times || !data.popular_times.length) {
throw new Error("ç„¡äººæµè³‡æ–™");
}

const currentHour = new Date().getHours();
const today = new Date().getDay(); // Sunday = 0
const times = data.popular_times.find(d => d.name === getDayName(today));
const level = times.data[currentHour];
const text = `ã€${query}ã€‘ç¾æ™‚äººæµï¼š${level}ï¼…`;

document.getElementById('status').textContent = text;
speak(text);
} catch (err) {
document.getElementById('status').textContent = "âš ï¸ ç„¡æ³•å–å¾—äººæµè³‡æ–™";
console.error("Error:", err);
}
}

function getDayName(dayNum) {
const days = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
return days[dayNum];
}

function speak(text) {
const utterance = new SpeechSynthesisUtterance(text);
utterance.lang = "zh-HK";
window.speechSynthesis.cancel(); // é˜²æ­¢é‡è¤‡æ’­
window.speechSynthesis.speak(utterance);
}
</script>
</body>
</html>
