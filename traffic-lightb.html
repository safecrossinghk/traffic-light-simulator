<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<title>å¯¦æ™‚ç´…ç¶ ç‡ˆç›£æ¸¬ï¼ˆè”æè§’é“ / é•·è”è¡—ï¼‰</title>
<style>
body { font-family: "Microsoft JhengHei", sans-serif; text-align: center; background: #f0f0f0; padding: 20px; }
#map { width: 100%; height: 50vh; margin-bottom: 20px; }
#status { font-size: 28px; margin: 20px; }
#countdown { font-size: 64px; font-weight: bold; color: green; }
</style>
</head>
<body>
<h1>è”æè§’é“ âœ• é•·è”è¡— ç´…ç¶ ç‡ˆå¯¦æ™‚ç‹€æ…‹</h1>
<div id="map"></div>
<div id="status">ğŸ”„ æ­£åœ¨è¼‰å…¥äº¤é€šç‡ˆç‹€æ…‹â‹¯â‹¯</div>
<div id="countdown">--</div>

<!-- åœ°åœ– JSï¼ˆå·²å«ä¼æ¥­é‡‘é‘°ï¼‰ -->
<script src="https://crosslight-proxy.safe-domain.hk/sdk/gmap-loader.js"></script>

<script>
// åˆå§‹åŒ–åœ°åœ–
function initMap() {
const map = new AMap.Map('map', {
zoom: 18,
center: [114.16115, 22.33745], // è”æè§’é“èˆ‡é•·è”è¡—äº¤ç•Œ
resizeEnable: true
});

const marker = new AMap.Marker({
position: [114.16115, 22.33745],
map: map,
title: 'è·¯å£ A'
});
}

initMap();

// æ’­æ”¾èªéŸ³æç¤ºï¼ˆä½¿ç”¨èªéŸ³åˆæˆï¼‰
function speak(text) {
const msg = new SpeechSynthesisUtterance(text);
msg.lang = 'zh-HK';
window.speechSynthesis.cancel(); // åœæ­¢èˆŠèªéŸ³
window.speechSynthesis.speak(msg);
}

// æ›´æ–°ç´…ç¶ ç‡ˆç‹€æ…‹
async function updateLight() {
try {
const res = await fetch('https://crosslight-proxy.safe-domain.hk/traffic-light/now?junction=lcj-lsg');
const data = await res.json();

const statusText = document.getElementById('status');
const countdown = document.getElementById('countdown');

if (data.phase === 'green') {
statusText.innerText = 'ğŸŸ¢ è¡Œäººç¶ ç‡ˆäº®èµ·';
countdown.innerText = data.remain + ' ç§’';
countdown.style.color = 'green';
} else if (data.phase === 'flashing') {
statusText.innerText = 'ğŸŸ¢ è¡Œäººç¶ ç‡ˆé–ƒçˆä¸­';
countdown.innerText = data.remain + ' ç§’';
countdown.style.color = 'orange';
} else {
statusText.innerText = 'ğŸ”´ è¡Œäººç´…ç‡ˆï¼Œè«‹å‹¿éé¦¬è·¯';
countdown.innerText = '--';
countdown.style.color = 'red';
}

if (data.voice) {
speak(data.voice);
}

} catch (err) {
document.getElementById('status').innerText = 'âš ï¸ ç„¡æ³•å–å¾—ç´…ç¶ ç‡ˆè³‡æ–™';
document.getElementById('countdown').innerText = '--';
}
}

updateLight();
setInterval(updateLight, 5000);
</script>
</body>
</html>