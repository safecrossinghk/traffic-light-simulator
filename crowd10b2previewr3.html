<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>ğŸ“ å³æ™‚åŠé è¨ˆäººæµæŸ¥è©¢</title>
<style>
body {
font-family: Arial, sans-serif;
text-align: center;
padding: 30px;
}
input {
padding: 10px;
width: 300px;
}
button {
padding: 10px 20px;
margin-left: 10px;
}
.result {
margin-top: 30px;
font-size: 1.2em;
}
.error {
color: red;
}
</style>
</head>
<body>
<h2>ğŸ“ å³æ™‚åŠé è¨ˆäººæµæŸ¥è©¢</h2>
<input type="text" id="place" placeholder="é¦™æ¸¯åœ‹éš›æ©Ÿå ´, å¤ªå¤åŸä¸­å¿ƒ..." />
<button onclick="doQuery()">æŸ¥è©¢</button>

<div class="result">
<p id="realtime"></p>
<p id="forecast"></p>
<p id="error" class="error"></p>
</div>

<script>
async function doQuery() {
const place = document.getElementById("place").value.trim();
const rt = document.getElementById("realtime");
const fc = document.getElementById("forecast");
const err = document.getElementById("error");

rt.textContent = '';
fc.textContent = '';
err.textContent = '';

if (!place) {
err.textContent = "âŒ è«‹è¼¸å…¥æŸ¥è©¢åœ°é»";
return;
}

try {
// Call Cloudflare Worker API
const response = await fetch(`https://sweet-credit-68c9.ctakwah.workers.dev/?query=${encodeURIComponent(place)}`);
const data = await response.json();

if (data.error) {
throw new Error(data.errorMessage || "API éŒ¯èª¤");
}

// é¡¯ç¤ºå³æ™‚äººæµ
rt.textContent = `âœ… å³æ™‚äººæµç‹€æ³ï¼š${data.query} â ${data.popular_times?.live || 'ç„¡æ•¸æ“š'}`;

// é¡¯ç¤ºé è¨ˆï¼ˆä¸‹ 1 å°æ™‚ï¼‰äººæµï¼ˆæ ¹æ“šæ—¥æœŸ + æ™‚é–“ç¯©é¸ï¼‰
const now = new Date();
const hour = now.getHours() + 1; // é æ¸¬ä¸‹ 1 å°æ™‚
const weekday = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"][now.getDay()];

const nextHour = data.popular_times?.[weekday]?.find(x => x.x === hour);

if (nextHour) {
fc.textContent = `ğŸ• é è¨ˆ ${hour}:00 äººæµï¼š${nextHour.y}ï¼ˆå–®ä½ï¼šOutscraper è©•ä¼°å€¼ï¼‰`;
} else {
fc.textContent = "ğŸ” æœªæœ‰ä¸‹ä¸€å°æ™‚çš„é æ¸¬æ•¸æ“š";
}
} catch (e) {
err.textContent = `âŒ æŸ¥è©¢å¤±æ•—ï¼š${e.message}`;
}
}
</script>
</body>
</html>