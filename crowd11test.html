<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8" />
<title>å³æ™‚äººæµé æ¸¬ï¼ˆäº”åœ°é»ï¼‰</title>
<style>
body { font-family: sans-serif; background: #f7f7f7; padding: 20px; }
.location { background: white; border: 1px solid #ccc; padding: 15px; margin-bottom: 15px; border-radius: 8px; }
.name { font-weight: bold; font-size: 18px; }
.status { margin-top: 10px; font-size: 16px; }
</style>
</head>
<body>
<h2>å³æ™‚äººæµé æ¸¬ï¼ˆäº”åœ°é»ï¼‰</h2>

<div class="location" id="loc1">
<div class="name">æ—ºè§’æœ—è±ªåŠ</div>
<div class="status">è¼‰å…¥ä¸­...</div>
</div>
<div class="location" id="loc2">
<div class="name">è¥¿ä¹é¾é«˜éµç«™</div>
<div class="status">è¼‰å…¥ä¸­...</div>
</div>
<div class="location" id="loc3">
<div class="name">é¦™æ¸¯åœ‹éš›æ©Ÿå ´</div>
<div class="status">è¼‰å…¥ä¸­...</div>
</div>
<div class="location" id="loc4">
<div class="name">é‡‘é˜å»Š</div>
<div class="status">è¼‰å…¥ä¸­...</div>
</div>
<div class="location" id="loc5">
<div class="name">ä¸­ç’°ç¢¼é ­</div>
<div class="status">è¼‰å…¥ä¸­...</div>
</div>

<script>
const locations = [
{ name: "æ—ºè§’æœ—è±ªåŠ", id: "loc1" },
{ name: "è¥¿ä¹é¾é«˜éµç«™", id: "loc2" },
{ name: "é¦™æ¸¯åœ‹éš›æ©Ÿå ´", id: "loc3" },
{ name: "é‡‘é˜å»Š", id: "loc4" },
{ name: "ä¸­ç’°ç¢¼é ­", id: "loc5" }
];

const endpoint = "https://safecrossing-worker.cloudflare.workers.dev/?query=";

locations.forEach(loc => {
fetch(endpoint + encodeURIComponent(loc.name))
.then(res => res.json())
.then(data => {
const el = document.querySelector(`#${loc.id} .status`);
const now = new Date();
const dayIndex = now.getDay(); // 0 = Sunday
const hour = now.getHours();
const dayMap = [6, 0, 1, 2, 3, 4, 5]; // map Sunday (0) to 6, Monday to 0, etc.
const todayData = data.popular_times?.[dayMap[dayIndex]];

if (!data.popular_times || data.popular_times.length === 0) {
el.innerHTML = "âš ï¸ ç„¡æ³•å–å¾—äººæµé æ¸¬æ•¸æ“š";
} else if (!todayData || !todayData.data || typeof todayData.data[hour] !== "number") {
el.innerHTML = "âš ï¸ ä»Šæ—¥é æ¸¬è³‡æ–™ä¸å®Œæ•´";
} else if (todayData.data[hour] === 0) {
el.innerHTML = "âœ… åœ°é»ç‡Ÿé‹å·²çµæŸæˆ–ç›®å‰ç„¡äººæµ";
} else {
el.innerHTML = `ğŸ“Š å³æ™‚äººæµé æ¸¬ï¼š${todayData.data[hour]}%`;
}
})
.catch(err => {
const el = document.querySelector(`#${loc.id} .status`);
el.innerHTML = "âš ï¸ æŸ¥è©¢å¤±æ•—";
});
});
</script>
</body>
</html>