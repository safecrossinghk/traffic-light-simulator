<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<title>å¯¦æ™‚äººæµæŸ¥è©¢</title>
<style>
body { font-family: sans-serif; padding: 20px; background: #f9f9f9; }
h2 { margin-top: 30px; }
.location { margin-bottom: 20px; }
.status { font-size: 18px; padding: 8px; border-radius: 5px; display: inline-block; }
.green { background: #d4edda; color: #155724; }
.yellow { background: #fff3cd; color: #856404; }
.red { background: #f8d7da; color: #721c24; }
</style>
</head>
<body>
<h1>ğŸ“ å³æ™‚äººæµæŸ¥è©¢</h1>
<div id="results"></div>

<script>
const locations = [
"èƒç£è¥¿ç«™",
"æ—ºè§’æœ—è±ªåŠ",
"æ·±æ°´åŸ—åœ°éµç«™",
"å°–æ²™å’€æµ·æ¸¯åŸ",
"ä¸­ç’°äº¤æ˜“å»£å ´"
];

const workerBase = "https://dry-violet-d7b1.ctakwah.workers.dev/?query=";

function getCrowdColor(percentage) {
if (percentage < 40) return "green";
if (percentage < 70) return "yellow";
return "red";
}

function speak(text, lang) {
const utter = new SpeechSynthesisUtterance(text);
utter.lang = lang;
window.speechSynthesis.speak(utter);
}

async function fetchData() {
const container = document.getElementById("results");
container.innerHTML = "";

for (const name of locations) {
const div = document.createElement("div");
div.className = "location";
div.innerHTML = `<h2>${name}</h2><div>â³ è¼‰å…¥ä¸­...</div>`;
container.appendChild(div);

try {
const res = await fetch(workerBase + encodeURIComponent(name));
const data = await res.json();

if (!data.success || !data.popular_times || data.popular_times.length === 0) {
div.innerHTML = `<h2>${name}</h2><div class="status yellow">âš ï¸ ç„¡æ³•å–å¾—äººæµè³‡æ–™</div>`;
continue;
}

const now = new Date();
const dayIndex = (now.getDay() + 6) % 7; // Sunday = 0 âœ index 6
const hour = now.getHours();
const todayData = data.popular_times[dayIndex];
const hourData = todayData.data.find(h => h.hour === hour);

if (!hourData) {
div.innerHTML = `<h2>${name}</h2><div class="status yellow">âš ï¸ è³‡æ–™ç¼ºå¤±</div>`;
continue;
}

const percentage = hourData.percentage;
const color = getCrowdColor(percentage);
div.innerHTML = `<h2>${name}</h2><div class="status ${color}">ç›®å‰äººæµï¼š${percentage}%</div>`;

// æ’­å ±èªéŸ³ï¼ˆç²µèª + è‹±èªï¼‰
speak(`${name}ç›®å‰äººæµç‚º ${percentage}%ã€‚`, "zh-HK");
speak(`The current crowd level at ${name} is ${percentage} percent.`, "en-US");

} catch (err) {
div.innerHTML = `<h2>${name}</h2><div class="status red">âŒ éŒ¯èª¤ï¼š${err.message}</div>`;
}
}
}

fetchData();
setInterval(fetchData, 5 * 60 * 1000); // æ¯ 5 åˆ†é˜æ›´æ–°
</script>
</body>
</html>