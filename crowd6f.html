<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<title>ğŸ“ å³æ™‚äººæµæŸ¥è©¢</title>
<style>
body { font-family: "Microsoft JhengHei", sans-serif; background: #fff; color: #333; }
h2 { margin-bottom: 10px; }
.location { border-bottom: 1px solid #ccc; padding: 10px 0; }
.status { font-weight: bold; }
.green { color: green; }
.yellow { color: orange; }
.red { color: red; }
</style>
</head>
<body>
<h2>ğŸ“ å³æ™‚äººæµæŸ¥è©¢</h2>
<div id="results"></div>

<script>
const apiKey = "MWE3NWNmMzFjZWNiNGMxMDlhNGNhNDFjNTY3ZjZkMTB8NzY5ZGY0MGQ0Zg";
const places = [
"èƒç£è¥¿ç«™",
"æ—ºè§’æœ—è±ªåŠ",
"æ·±æ°´åŸ—åœ°éµç«™",
"å°–æ²™å’€æµ·æ¸¯åŸ",
"ä¸­ç’°äº¤æ˜“å»£å ´"
];

const resultsDiv = document.getElementById("results");

async function fetchCrowdData(place) {
const encodedPlace = encodeURIComponent(place);
const url = `https://api.app.outscraper.com/maps/search-v2?query=${encodedPlace}&limit=1&language=zh-HK&region=hk`;

try {
const res = await fetch(url, {
method: "GET",
headers: {
"X-API-KEY": apiKey,
"Content-Type": "application/json"
}
});

if (!res.ok) throw new Error(`HTTP ${res.status}`);

const data = await res.json();
const entry = data.data[0];
let crowdLevel = "æ­¤åœ°é»æš«ç„¡äººæµè³‡æ–™";
let crowdClass = "";
if (entry?.popular_times) {
const dayIndex = new Date().getDay(); // Sunday = 0
const hour = new Date().getHours();
const todayData = entry.popular_times.find(p => p.day === dayIndex);
if (todayData && todayData.data[hour] !== undefined) {
const percentage = todayData.data[hour];
crowdLevel = `ç›®å‰äººæµç´„ ${percentage}%`;
if (percentage < 40) crowdClass = "green";
else if (percentage < 70) crowdClass = "yellow";
else crowdClass = "red";
}
}

return { place, crowdLevel, crowdClass };

} catch (err) {
console.warn(`${place} æŸ¥è©¢éŒ¯èª¤ï¼š`, err);
return { place, crowdLevel: "âš ï¸ æ­¤åœ°é»æš«ç„¡äººæµè³‡æ–™", crowdClass: "" };
}
}

async function updateAll() {
resultsDiv.innerHTML = "";
for (const place of places) {
const result = await fetchCrowdData(place);
const div = document.createElement("div");
div.className = "location";
div.innerHTML = `<div>${result.place}</div><div class="status ${result.crowdClass}">${result.crowdLevel}</div>`;
resultsDiv.appendChild(div);
}
}

updateAll();
setInterval(updateAll, 5 * 60 * 1000); // æ¯5åˆ†é˜æ›´æ–°
</script>
</body>
</html>