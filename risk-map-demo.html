<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>è”æè§’ï¼é•·æ²™ç£ è­¦åŠ›é¢¨éšªç›£æ¸¬ Demo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link
rel="stylesheet"
href="https://unpkg.com/leaflet/dist/leaflet.css"
/>
<style>
#map { height: 80vh; }
.info { padding: 6px 8px; background: white; }
.btn { margin: 8px; padding: 6px 12px; cursor: pointer; }
</style>
</head>
<body>
<h2>ğŸ” è”æè§’ & é•·æ²™ç£ è­¦åŠ›é¢¨éšªç›£æ¸¬ï¼ˆæ¨¡æ“¬ç‰ˆï¼‰</h2>
<div id="map"></div>
<button id="refreshBtn" class="btn">æ‰‹å‹•æ›´æ–°é¢¨éšªç‹€æ…‹</button>
<div id="info" class="info"></div>

<audio id="audioAlert" src="alert-cantonese.mp3"></audio>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const areas = {
'è”æè§’': { coords: [22.3345, 114.1574], risk: 'ç¶ ' },
'é•·æ²™ç£': { coords: [22.3338, 114.1579], risk: 'ç¶ ' },
};

const riskColors = { 'é«˜': 'red', 'ä¸­': 'orange', 'ç¶ ': 'green' };

const map = L.map('map').setView([22.334, 114.1575], 15);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
attribution: 'Â© OpenStreetMap'
}).addTo(map);

const markers = {};
Object.entries(areas).forEach(([name, data]) => {
markers[name] = L.circle(data.coords, {
color: riskColors[data.risk],
radius: 200,
}).addTo(map).bindPopup(name);
});

function simulateFetchData() {
return {
'è”æè§’': {
flowChange: Math.random() < 0.5 ? 'æ€¥é™' : 'ç©©å®š',
traffic: Math.random() < 0.3 ? 'å°è·¯ï¼ç·©æ…¢' : 'æ­£å¸¸',
news: Math.random() < 0.4,
},
'é•·æ²™ç£': {
flowChange: Math.random() < 0.5 ? 'æ€¥é™' : 'ç©©å®š',
traffic: Math.random() < 0.3 ? 'å°è·¯ï¼ç·©æ…¢' : 'æ­£å¸¸',
news: Math.random() < 0.4,
}
};
}

async function updateRisk() {
const data = simulateFetchData();
const infoDiv = document.getElementById('info');
infoDiv.innerHTML = '';

Object.entries(data).forEach(([name, d]) => {
let risk = 'ç¶ ';
if (d.flowChange === 'æ€¥é™' && d.traffic !== 'æ­£å¸¸' && d.news) {
risk = 'é«˜';
} else if (
(d.flowChange === 'æ€¥é™' && d.traffic !== 'æ­£å¸¸') ||
(d.flowChange === 'æ€¥é™' && d.news) ||
(d.traffic !== 'æ­£å¸¸' && d.news)
) {
risk = 'ä¸­';
}
areas[name].risk = risk;
markers[name].setStyle({ color: riskColors[risk] });
infoDiv.innerHTML += `
<strong>${name}ï¼š</strong>
äººæµï¼š${d.flowChange}ï¼›äº¤é€šï¼š${d.traffic}ï¼›æ–°èæç¤ºï¼š${d.news ? 'æœ‰' : 'ç„¡'} â†’ <span style="color:${riskColors[risk]}">${risk === 'ç¶ ' ? 'âœ… ä½é¢¨éšª' : (risk === 'ä¸­' ? 'âš ï¸ ä¸­é¢¨éšª' : 'ğŸ”´ é«˜é¢¨éšª')}</span><br>
`;
if (areas[name].risk === 'é«˜') {
document.getElementById('audioAlert').play();
}
});
}

document.getElementById('refreshBtn').onclick = updateRisk;

updateRisk();
setInterval(updateRisk, 300000); // æ¯äº”åˆ†é˜

</script>
</body>
</html>