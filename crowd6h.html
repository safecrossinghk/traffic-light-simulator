<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>å³æ™‚äººæµæŸ¥è©¢ï¼ˆäº”å€‹åœ°é»ï¼‰</title>
<style>
body { font-family: sans-serif; padding: 20px; }
.place { margin-bottom: 15px; }
.status { font-weight: bold; padding: 4px 8px; border-radius: 4px; display: inline-block; }
.low { background-color: #a0e7a0; color: #065f00; } /* ç–è½ - ç¶ è‰² */
.medium { background-color: #fff3b0; color: #8a6d00; } /* æ­£å¸¸ - é»ƒè‰² */
.high { background-color: #f8a5a5; color: #8b0000; } /* æ“æ“  - ç´…è‰² */
.error { color: #d00; font-weight: bold; }
</style>
</head>
<body>
<h2>ğŸ“ å³æ™‚äººæµæŸ¥è©¢ï¼ˆäº”å€‹åœ°é»ï¼‰</h2>
<div id="results"></div>

<script>
const places = [
"èƒç£è¥¿ç«™",
"æ—ºè§’æœ—è±ªåŠ",
"æ·±æ°´åŸ—åœ°éµç«™",
"å°–æ²™å’€æµ·æ¸¯åŸ",
"ä¸­ç’°äº¤æ˜“å»£å ´"
];

const apiKey = "MWE3NWNmMzFjZWNiNGMxMDlhNGNhNDFjNTY3ZjZkMTB8NzY5ZGY0MGQ0Zg";
const resultsDiv = document.getElementById("results");

async function fetchCrowdData(place) {
const url = `https://api.app.outscraper.com/maps/search-v2?query=${encodeURIComponent(place)}&limit=1&language=zh-HK&region=hk`;
try {
const response = await fetch(url, {
headers: { "X-API-KEY": apiKey }
});
const data = await response.json();
const item = data.data[0];

if (item && item.popular_times && item.popular_times.length > 0) {
const now = new Date();
const weekday = now.getDay(); // 0 = Sunday
const hour = now.getHours();
const times = item.popular_times.find(p => p.day === weekday);
const crowd = times ? times.hours[hour] : null;

let level = "";
let className = "";

if (crowd === null || crowd === undefined) {
return `<div class="place"><strong>${place}</strong><br/><span class="error">âš ï¸ æ­¤åœ°é»æš«ç„¡äººæµè³‡æ–™</span></div>`;
} else if (crowd <= 30) {
level = "ç–è½";
className = "low";
} else if (crowd <= 70) {
level = "æ­£å¸¸";
className = "medium";
} else {
level = "æ“æ“ ";
className = "high";
}

return `<div class="place"><strong>${place}</strong><br/><span class="status ${className}">${level}</span></div>`;
} else {
return `<div class="place"><strong>${place}</strong><br/><span class="error">âš ï¸ æ­¤åœ°é»æš«ç„¡äººæµè³‡æ–™</span></div>`;
}
} catch (err) {
return `<div class="place"><strong>${place}</strong><br/><span class="error">âš ï¸ æ­¤åœ°é»æš«ç„¡äººæµè³‡æ–™</span></div>`;
}
}

async function updateAll() {
resultsDiv.innerHTML = "ğŸ”„ æŸ¥è©¢ä¸­...";
const outputs = await Promise.all(places.map(p => fetchCrowdData(p)));
resultsDiv.innerHTML = outputs.join("");
}

updateAll();
setInterval(updateAll, 5 * 60 * 1000); // æ¯5åˆ†é˜è‡ªå‹•æ›´æ–°
</script>
</body>
</html>