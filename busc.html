<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>實時巴士追蹤（2B / 701A）</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: sans-serif;
    }
    #map {
      height: 60%;
      width: 100%;
    }
    #info {
      padding: 10px;
      font-size: 1.1em;
    }
    #eta-list {
      list-style: none;
      padding: 0;
    }
    li {
      margin-bottom: 8px;
    }
    @media (max-width: 600px) {
      #info {
        font-size: 1em;
      }
    }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCe2towtdCB_tiGtfXFQbdk9Kq63T3D2UU"></script>
</head>
<body>
  <div id="map"></div>
  <div id="info">
    <h2>🚌 實時追蹤：九巴 2B / 城巴 701A</h2>
    <ul id="eta-list"><li>讀取資料中...</li></ul>
  </div>

  <script>
    const map = new google.maps.Map(document.getElementById("map"), {
      zoom: 14,
      center: { lat: 22.33, lng: 114.17 },
    });

    let marker = new google.maps.Marker({
      position: { lat: 22.33, lng: 114.17 },
      map,
      icon: "https://maps.google.com/mapfiles/ms/icons/bus.png",
    });

    function speak(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'zh-HK';
      speechSynthesis.speak(utterance);
    }

    async function fetchETA() {
      const etaList = document.getElementById("eta-list");
      etaList.innerHTML = "";

      try {
        // 模擬 KMB & 城巴 API 回傳數據
        const stops = [
          { name: "深水埗", eta: 3, lat: 22.330, lng: 114.160 },
          { name: "旺角奶路臣街", eta: 6, lat: 22.318, lng: 114.170 },
          { name: "油麻地", eta: 9, lat: 22.310, lng: 114.173 }
        ];

        stops.forEach(stop => {
          const li = document.createElement("li");
          li.textContent = `📍 ${stop.name}：${stop.eta} 分鐘後到達`;
          etaList.appendChild(li);
          if (stop.eta <= 2) speak(`巴士即將到達 ${stop.name}`);
        });

        // 估算巴士位置為最接近一個站點的上游位置
        const firstStop = stops[0];
        marker.setPosition({ lat: firstStop.lat, lng: firstStop.lng });
        map.panTo({ lat: firstStop.lat, lng: firstStop.lng });

      } catch (e) {
        etaList.innerHTML = "<li>🚫 無法讀取數據</li>";
        console.error(e);
      }
    }

    setInterval(fetchETA, 10000); // 每 10 秒更新一次
    fetchETA();
  </script>
</body>
</html>