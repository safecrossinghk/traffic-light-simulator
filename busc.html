<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>å¯¦æ™‚å·´å£«è¿½è¹¤ï¼ˆ2B / 701Aï¼‰</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: sans-serif;
    }
    #map {
      height: 60%;
      width: 100%;
    }
    #info {
      padding: 10px;
      font-size: 1.1em;
    }
    #eta-list {
      list-style: none;
      padding: 0;
    }
    li {
      margin-bottom: 8px;
    }
    @media (max-width: 600px) {
      #info {
        font-size: 1em;
      }
    }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCe2towtdCB_tiGtfXFQbdk9Kq63T3D2UU"></script>
</head>
<body>
  <div id="map"></div>
  <div id="info">
    <h2>ğŸšŒ å¯¦æ™‚è¿½è¹¤ï¼šä¹å·´ 2B / åŸå·´ 701A</h2>
    <ul id="eta-list"><li>è®€å–è³‡æ–™ä¸­...</li></ul>
  </div>

  <script>
    const map = new google.maps.Map(document.getElementById("map"), {
      zoom: 14,
      center: { lat: 22.33, lng: 114.17 },
    });

    let marker = new google.maps.Marker({
      position: { lat: 22.33, lng: 114.17 },
      map,
      icon: "https://maps.google.com/mapfiles/ms/icons/bus.png",
    });

    function speak(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'zh-HK';
      speechSynthesis.speak(utterance);
    }

    async function fetchETA() {
      const etaList = document.getElementById("eta-list");
      etaList.innerHTML = "";

      try {
        // æ¨¡æ“¬ KMB & åŸå·´ API å›å‚³æ•¸æ“š
        const stops = [
          { name: "æ·±æ°´åŸ—", eta: 3, lat: 22.330, lng: 114.160 },
          { name: "æ—ºè§’å¥¶è·¯è‡£è¡—", eta: 6, lat: 22.318, lng: 114.170 },
          { name: "æ²¹éº»åœ°", eta: 9, lat: 22.310, lng: 114.173 }
        ];

        stops.forEach(stop => {
          const li = document.createElement("li");
          li.textContent = `ğŸ“ ${stop.name}ï¼š${stop.eta} åˆ†é˜å¾Œåˆ°é”`;
          etaList.appendChild(li);
          if (stop.eta <= 2) speak(`å·´å£«å³å°‡åˆ°é” ${stop.name}`);
        });

        // ä¼°ç®—å·´å£«ä½ç½®ç‚ºæœ€æ¥è¿‘ä¸€å€‹ç«™é»çš„ä¸Šæ¸¸ä½ç½®
        const firstStop = stops[0];
        marker.setPosition({ lat: firstStop.lat, lng: firstStop.lng });
        map.panTo({ lat: firstStop.lat, lng: firstStop.lng });

      } catch (e) {
        etaList.innerHTML = "<li>ğŸš« ç„¡æ³•è®€å–æ•¸æ“š</li>";
        console.error(e);
      }
    }

    setInterval(fetchETA, 10000); // æ¯ 10 ç§’æ›´æ–°ä¸€æ¬¡
    fetchETA();
  </script>
</body>
</html>