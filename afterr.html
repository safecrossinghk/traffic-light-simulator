<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>å³æ™‚é™„è¿‘äººæµæƒ…æ³</title>
<style>
body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
#controls { padding: 10px; background: #f0f0f0; text-align: center; }
#map { width: 100%; height: 60vh; }
#output { padding: 10px; }
.location-box { border: 1px solid #ccc; padding: 10px; margin: 8px 0; border-radius: 5px; }
.busy { background-color: #ffdddd; }
.moderate { background-color: #fff7cc; }
.clear { background-color: #ddffdd; }
</style>
</head>
<body>
<div id="controls">
<label for="lang">èªè¨€ï¼š</label>
<button onclick="setLang('zh')">ä¸­æ–‡</button>
<button onclick="setLang('en')">English</button>
<button onclick="fetchData()">ğŸ”„ æ›´æ–°äººæµè³‡æ–™</button>
</div>

<div id="map"></div>
<div id="output"></div>

<script>
const API_KEY = 'MWE3NWNmMzFjZWNiNGMxMDlhNGNhNDFjNTY3ZjZkMTB8NzY5ZGY0MGQ0Zg'; // æ›¿æ›æˆä½ çš„ Outscraper API é‡‘é‘°
const locations = [
{ name_zh: 'é¦™æ¸¯åœ‹éš›æ©Ÿå ´', name_en: 'Hong Kong International Airport', lat: 22.3080, lng: 113.9185 },
{ name_zh: 'é«˜éµè¥¿ä¹é¾ç«™', name_en: 'West Kowloon High-Speed Rail Station', lat: 22.3044, lng: 114.1615 },
{ name_zh: 'Lo Wu Station Hong Kong', name_en: 'Lo Wu Station Hong Kong', lat: 22.5296, lng: 114.1131 },
{ name_zh: 'Lok Ma Chau Station Hong Kong', name_en: 'Lok Ma Chau Station Hong Kong', lat: 22.5144, lng: 114.0595 },
{ name_zh: 'Heung Yuen Wai Boundary Control Point Public Toilet (II)', name_en: 'Heung Yuen Wai Boundary Control Point Public Toilet (II)', lat: 22.5482, lng: 114.1258 },
{ name_zh: 'æ·±åœ³ç£å£å²¸', name_en: 'Shenzhen Bay Control Point', lat: 22.5032, lng: 113.9540 },
{ name_zh: 'æ¸¯ç æ¾³å¤§æ©‹å£å²¸', name_en: 'HZMB Hong Kong Port', lat: 22.3081, lng: 113.6788 },
{ name_zh: 'çš‡å´—å£å²¸', name_en: 'Huanggang Port', lat: 22.5271, lng: 114.0708 }
];

let lang = 'zh';
let map;
let markers = [];

function setLang(l) {
lang = l;
fetchData();
}

function classifyPopularity(p) {
if (p >= 70) return 'busy';
if (p >= 30) return 'moderate';
return 'clear';
}

function speak(text) {
const utterance = new SpeechSynthesisUtterance(text);
utterance.lang = lang === 'zh' ? 'zh-HK' : 'en-US';
speechSynthesis.cancel(); // åœæ­¢ç¾æœ‰æ’­å ±
speechSynthesis.speak(utterance);
}

function fetchData() {
document.getElementById('output').innerHTML = 'â³ æ­£åœ¨è¼‰å…¥å³æ™‚è³‡æ–™...';
const names = locations.map(loc => lang === 'zh' ? loc.name_zh : loc.name_en).join(',');

fetch(`https://api.app.outscraper.com/maps/search-v2?query=${encodeURIComponent(names)}&limit=1`, {
headers: { 'X-API-KEY': API_KEY }
})
.then(res => res.json())
.then(data => {
const results = data[0]?.data || [];
const output = document.getElementById('output');
output.innerHTML = '';

clearMarkers();

locations.forEach(loc => {
const result = results.find(r =>
(r.title || '').includes(lang === 'zh' ? loc.name_zh : loc.name_en)
);
let popularity = result?.current_popularity;
let fallback = result?.popular_times ? true : false;
let statusClass = 'clear';
let message = '';

if (popularity != null) {
statusClass = classifyPopularity(popularity);
message = lang === 'zh'
? `${loc.name_zh}ï¼šç›®å‰äººæµæŒ‡æ•¸ç‚º ${popularity}ã€‚`
: `${loc.name_en}: Current popularity index is ${popularity}.`;
} else if (fallback) {
message = lang === 'zh'
? `${loc.name_zh}ï¼šç„¡å³æ™‚è³‡æ–™ï¼Œåƒ…ä¾›æ­·å²åƒè€ƒã€‚`
: `${loc.name_en}: No live data, historical data only.`;
} else {
message = lang === 'zh'
? `${loc.name_zh}ï¼šç„¡è³‡æ–™ã€‚`
: `${loc.name_en}: No data.`;
}

const div = document.createElement('div');
div.className = `location-box ${statusClass}`;
div.textContent = message;
output.appendChild(div);

const marker = new google.maps.Marker({
position: { lat: loc.lat, lng: loc.lng },
map,
label: lang === 'zh' ? loc.name_zh : loc.name_en
});
markers.push(marker);
});

// æ’­å ±ç†±é–€åœ°é»
const hot = results.filter(p => p.current_popularity >= 70);
if (hot.length > 0) {
const speakText = lang === 'zh'
? 'âš ï¸ éƒ¨åˆ†åœ°é»äººæµæ“æ“ ï¼Œå»ºè­°ç¨å¾Œå‰å¾€ã€‚'
: 'âš ï¸ Some locations are very crowded. Please consider visiting later.';
speak(speakText);
} else {
const speakText = lang === 'zh'
? 'âœ… ç›®å‰å„åœ°é»äººæµæ­£å¸¸ï¼Œè«‹å®‰å¿ƒå‰å¾€ã€‚'
: 'âœ… Current traffic is normal. Safe to proceed.';
speak(speakText);
}
})
.catch(err => {
console.error(err);
document.getElementById('output').innerHTML = lang === 'zh'
? 'âŒ ç„¡æ³•å–å¾—è³‡æ–™ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚'
: 'âŒ Failed to fetch data. Please try again later.';
});
}

function initMap() {
map = new google.maps.Map(document.getElementById('map'), {
center: { lat: 22.3964, lng: 114.1095 },
zoom: 11
});
fetchData();
setInterval(fetchData, 300000); // æ¯ 5 åˆ†é˜æ›´æ–°ä¸€æ¬¡
}

function clearMarkers() {
markers.forEach(m => m.setMap(null));
markers = [];
}
</script>

<!-- Google Maps API -->
<script async defer
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC5EiwICC0wjVsscauKVrHhlA8tDMG1jPY&callback=initMap">
</script>
</body>
</html>