<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<title>ğŸ“å³æ™‚äººæµæŸ¥è©¢</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
h2 { color: darkred; }
.place { margin-bottom: 20px; }
.status { font-weight: bold; }
.green { color: green; }
.orange { color: orange; }
.red { color: red; }
.error { color: darkred; }
</style>
</head>
<body>
<h2>ğŸ“å³æ™‚äººæµæŸ¥è©¢</h2>
<div id="results"></div>

<script>
const places = [
{ name: "èƒç£è¥¿ç«™", id: "ChIJ0Y8Dyuj4AzQRObQ6ZpLAtpw" },
{ name: "æ—ºè§’æœ—è±ªåŠ", id: "ChIJSUsQeMcABDQRUladiJq44qw" },
{ name: "æ·±æ°´åŸ—åœ°éµç«™", id: "ChIJUaCTn7QABDQRhlcmZ-02QnU" },
{ name: "å°–æ²™å’€æµ·æ¸¯åŸ", id: "ChIJzXN62owABDQRMhRYGJnmKsY" },
{ name: "ä¸­ç’°äº¤æ˜“å»£å ´", id: "ChIJmYFgcWMABDQRZKPmTs0JiTQ" }
];

const resultDiv = document.getElementById("results");

function getStatusClass(pct) {
if (pct < 40) return "green";
if (pct < 70) return "orange";
return "red";
}

function getStatusText(pct) {
if (pct < 40) return "ç–è½";
if (pct < 70) return "æ­£å¸¸";
return "æ“æ“ ";
}

function speak(text, lang) {
const msg = new SpeechSynthesisUtterance(text);
msg.lang = lang;
window.speechSynthesis.speak(msg);
}

async function fetchData() {
resultDiv.innerHTML = ""; // Clear previous

for (const place of places) {
const div = document.createElement("div");
div.className = "place";
div.innerHTML = `<strong>${place.name}</strong><br>â³ è¼‰å…¥ä¸­...`;
resultDiv.appendChild(div);

try {
const res = await fetch(`https://dry-violet-d7b1.ctakwah.workers.dev/?id=${place.id}`);
const data = await res.json();

// éŒ¯èª¤é˜²å‘†
const now = new Date();
const currentDay = now.toLocaleString("en-US", { weekday: 'long' });
const currentHour = now.getHours();

const dayData = (data.popular_times || []).find(d => d.day_text === currentDay);

if (!dayData || !Array.isArray(dayData.data)) {
throw new Error("è³‡æ–™æ ¼å¼éŒ¯èª¤");
}

const hourData = dayData.data.find(h => h.hour === currentHour);

if (!hourData || typeof hourData.percentage !== "number") {
throw new Error("ä»Šæ—¥è³‡æ–™ç¼ºå¤±");
}

const pct = hourData.percentage;
const status = getStatusText(pct);
const statusClass = getStatusClass(pct);

div.innerHTML = `<strong>${place.name}</strong><br><span class="status ${statusClass}">${status}</span>`;
speak(`${place.name}ï¼š${status}`, "zh-HK");

} catch (err) {
div.innerHTML = `<strong>${place.name}</strong><br><span class="error">âš ï¸ éŒ¯èª¤ï¼š${err.message}</span>`;
}
}
}

fetchData();
setInterval(fetchData, 5 * 60 * 1000); // æ¯5åˆ†é˜æ›´æ–°ä¸€æ¬¡
</script>
</body>
</html>