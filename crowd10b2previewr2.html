<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8" />
<title>ğŸ“å³æ™‚åŠé è¨ˆäººæµæŸ¥è©¢</title>
<style>
body { font-family: sans-serif; text-align: center; padding: 2em; }
input, button { padding: 0.5em; font-size: 1em; }
#result, #forecast, #error { margin-top: 1em; font-size: 1.1em; }
#error { color: red; }
</style>
</head>
<body>
<h2>ğŸ“å³æ™‚åŠé è¨ˆäººæµæŸ¥è©¢</h2>
<input id="place" type="text" placeholder="ä¾‹å¦‚ï¼šæ—ºè§’åœ°éµç«™" size="30" />
<button onclick="query()">æŸ¥è©¢</button>
<div id="result"></div>
<div id="forecast"></div>
<div id="error"></div>

<script>
async function query() {
const place = document.getElementById('place').value.trim();
const resultDiv = document.getElementById('result');
const forecastDiv = document.getElementById('forecast');
const errorDiv = document.getElementById('error');
resultDiv.textContent = '';
forecastDiv.textContent = '';
errorDiv.textContent = '';

if (!place) {
errorDiv.textContent = 'âš ï¸ è«‹è¼¸å…¥æŸ¥è©¢åœ°é»ã€‚';
return;
}

try {
const res = await fetch(`https://sweet-credit-68c9.ctakwah.workers.dev/?query=${encodeURIComponent(place)}`);
const data = await res.json();

if (!data.success) {
errorDiv.textContent = 'âŒ æŸ¥è©¢å¤±æ•—ï¼š' + (data.message || 'ä¼ºæœå™¨éŒ¯èª¤');
return;
}

// âœ… å³æ™‚äººæµ
const live = data.popular_times.find(x => x.day === 'live');
if (live) {
resultDiv.textContent = `${place}ï¼šç¾æ™‚äººæµç‚º ${live.hour}%`;
speak(`${place} ç¾æ™‚äººæµç‚º ${live.hour} ç™¾åˆ†æ¯”`, 'zh-HK');
} else {
resultDiv.textContent = `${place}ï¼šæœªæœ‰å³æ™‚äººæµè³‡æ–™`;
}

// âœ… é æ¸¬äººæµï¼ˆæœªä¾† 3 å°æ™‚ï¼‰
const now = new Date();
const weekday = now.getDay(); // 0 = Sunday
const currentHour = now.getHours();
const weekDays = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
const dayName = weekDays[weekday];
const forecast = data.popular_times.find(x => x.day === dayName);

if (forecast) {
let forecastHTML = `<br><strong>é æ¸¬äººæµï¼ˆ${dayName}ï¼‰</strong><br>`;
for (let i = 0; i < 3; i++) {
const hour = (currentHour + i + 1) % 24;
const value = forecast.data[hour];
forecastHTML += `${hour}:00 âœ ${value}%<br>`;
}
forecastDiv.innerHTML = forecastHTML;
speak(`${place} æœªä¾†ä¸‰å°æ™‚é æ¸¬äººæµç‚ºï¼š${forecast.data[(currentHour+1)%24]}%ã€${forecast.data[(currentHour+2)%24]}%ã€${forecast.data[(currentHour+3)%24]}%ã€‚`, 'zh-HK');
} else {
forecastDiv.textContent = 'æœªèƒ½å–å¾—é æ¸¬è³‡æ–™';
}

} catch (err) {
errorDiv.textContent = 'âŒ éŒ¯èª¤ï¼š' + err.message;
}
}

function speak(text, lang) {
const msg = new SpeechSynthesisUtterance(text);
msg.lang = lang || 'zh-HK';
window.speechSynthesis.speak(msg);
}
</script>
</body>
</html>