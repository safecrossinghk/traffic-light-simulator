<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>å³æ™‚äººæµæŸ¥è©¢</title>
<style>
body { font-family: "Microsoft JhengHei", sans-serif; background: #fffbe6; padding: 20px; }
h1 { color: #c00; }
h2 { margin-bottom: 5px; }
.status { margin-bottom: 15px; font-weight: bold; }
.green { color: green; }
.yellow { color: orange; }
.red { color: red; }
</style>
</head>
<body>
<h1>ğŸ“ å³æ™‚äººæµæŸ¥è©¢</h1>
<div id="results">è¼‰å…¥ä¸­...</div>

<script>
const locations = [
{ name: "èƒç£è¥¿ç«™", query: "èƒç£è¥¿ç«™" },
{ name: "æ—ºè§’æœ—è±ªåŠ", query: "æ—ºè§’æœ—è±ªåŠ" },
{ name: "æ·±æ°´åŸ—åœ°éµç«™", query: "æ·±æ°´åŸ—åœ°éµç«™" },
{ name: "å°–æ²™å’€æµ·æ¸¯åŸ", query: "å°–æ²™å’€æµ·æ¸¯åŸ" },
{ name: "ä¸­ç’°äº¤æ˜“å»£å ´", query: "ä¸­ç’°äº¤æ˜“å»£å ´" }
];

const dayNames = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];

async function fetchCrowdData() {
const container = document.getElementById("results");
container.innerHTML = "";

const now = new Date();
const hour = now.getHours();
const todayText = dayNames[now.getDay()];

for (const loc of locations) {
const div = document.createElement("div");
try {
const res = await fetch(`https://dry-violet-d7b1.ctakwah.workers.dev/?query=${encodeURIComponent(loc.query)}`);
const json = await res.json();

if (!json.success || !json.popular_times || !Array.isArray(json.popular_times)) {
throw new Error("è³‡æ–™æ ¼å¼éŒ¯èª¤");
}

const todayData = json.popular_times.find(d => d.day === todayText);

if (!todayData || !todayData.data || !Array.isArray(todayData.data)) {
div.innerHTML = `<h2>${loc.name}</h2><div class="status yellow">âš ï¸ ä»Šæ—¥è³‡æ–™ç¼ºå¤±</div>`;
container.appendChild(div);
continue;
}

const hourData = todayData.data.find(h => h.hour === hour);
if (!hourData) {
div.innerHTML = `<h2>${loc.name}</h2><div class="status yellow">âš ï¸ æŒ‡å®šæ™‚æ®µè³‡æ–™ç¼ºå¤±</div>`;
container.appendChild(div);
continue;
}

const percent = hourData.percentage;
let level = "âšª ç„¡æ³•åˆ¤æ–·";
let css = "yellow";

if (percent < 30) {
level = "ğŸŸ¢ ç–è½";
css = "green";
} else if (percent < 60) {
level = "ğŸŸ¡ æ­£å¸¸";
css = "yellow";
} else {
level = "ğŸ”´ æ“æ“ ";
css = "red";
}

div.innerHTML = `<h2>${loc.name}</h2><div class="status ${css}">${level}</div>`;
} catch (e) {
div.innerHTML = `<h2>${loc.name}</h2><div class="status red">âŒ éŒ¯èª¤ï¼š${e.message}</div>`;
}
container.appendChild(div);
}
}

fetchCrowdData();
setInterval(fetchCrowdData, 5 * 60 * 1000); // æ¯ 5 åˆ†é˜è‡ªå‹•æ›´æ–°
</script>
</body>
</html>