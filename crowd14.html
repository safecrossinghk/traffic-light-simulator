<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>å³æ™‚äººæµæŸ¥è©¢ï¼ˆ5å€‹ç†±é–€åœ°é»ï¼‰</title>
<style>
body { font-family: sans-serif; padding: 20px; }
.location { margin-bottom: 20px; border-bottom: 1px solid #ccc; padding-bottom: 10px; }
.status { font-weight: bold; }
.low { color: green; }
.medium { color: orange; }
.high { color: red; }
.unknown { color: gray; }
</style>
</head>
<body>

<h2>ğŸ“ å³æ™‚äººæµæŸ¥è©¢ï¼ˆ5å€‹ç†±é–€åœ°é»ï¼‰</h2>
<div id="results"></div>

<script>
const locations = [
"Tsuen Wan West Station",
"Langham Place, Mong Kok",
"Sham Shui Po Station",
"Harbour City, Hong Kong",
"Exchange Square, Hong Kong"
];

const API_KEY = "MWE3NWNmMzFjZWNiNGMxMDlhNGNhNDFjNTY3ZjZkMTB8NzY5ZGY0MGQ0Zg";

function getCrowdLevelClass(value) {
if (value === undefined) return "unknown";
if (value <= 30) return "low";
if (value <= 60) return "medium";
return "high";
}

function getCrowdText(value, lang) {
if (value === undefined) {
return lang === "zh-HK" ? "â“ ç„¡è³‡æ–™" : "â“ Not available";
}
if (lang === "zh-HK") {
if (value <= 30) return `ğŸ˜Œ ç–è½ï¼ˆ${value}%ï¼‰`;
if (value <= 60) return `ğŸ™‚ æ­£å¸¸ï¼ˆ${value}%ï¼‰`;
return `ğŸ˜£ æ“æ“ ï¼ˆ${value}%ï¼‰`;
} else {
if (value <= 30) return `ğŸ˜Œ Relaxed (${value}%)`;
if (value <= 60) return `ğŸ™‚ Normal (${value}%)`;
return `ğŸ˜£ Crowded (${value}%)`;
}
}

function speak(text, lang) {
const utterance = new SpeechSynthesisUtterance(text);
utterance.lang = lang;
window.speechSynthesis.speak(utterance);
}

async function fetchCrowdData(place) {
const url = `https://api.app.outscraper.com/maps/search?query=${encodeURIComponent(place)}&fields=popular_times&limit=1&language=zh&region=hk`;
const response = await fetch(url, {
method: "GET",
headers: { "X-API-KEY": API_KEY }
});
const data = await response.json();
console.log("ğŸ“¦ å›å‚³è³‡æ–™ for", place, data);
return data?.[0]?.popular_times || null;
}

async function displayAll() {
const resultDiv = document.getElementById("results");
for (const place of locations) {
const el = document.createElement("div");
el.className = "location";
el.innerHTML = `<h3>${place}</h3><div class="status">ğŸ”„ è¼‰å…¥ä¸­â€¦</div>`;
resultDiv.appendChild(el);

try {
const data = await fetchCrowdData(place);
const now = new Date();
const weekday = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][now.getDay()];
const hour = now.getHours();
const level = data?.[weekday]?.[hour];
const lang = navigator.language.startsWith("zh") ? "zh-HK" : "en-US";
const className = getCrowdLevelClass(level);
const text = getCrowdText(level, lang);

const statusDiv = el.querySelector(".status");
statusDiv.innerText = text;
statusDiv.className = `status ${className}`;

// èªéŸ³
const spoken = lang === "zh-HK"
? `${place} ç¾æ™‚äººæµä¿‚ ${level !== undefined ? level + " ç™¾åˆ†æ¯”" : "ç„¡è³‡æ–™"}`
: `Current crowd level at ${place} is ${level !== undefined ? level + " percent" : "not available"}`;
speak(spoken, lang);

} catch (e) {
const statusDiv = el.querySelector(".status");
statusDiv.innerText = "âš ï¸ æŸ¥è©¢å¤±æ•—ï¼š" + e.message;
statusDiv.className = "status unknown";
}
}
}

displayAll();
</script>

</body>
</html>
