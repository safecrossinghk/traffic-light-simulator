<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>AIé¢¨æš´æ¶ˆæ¯</title>
<style>
body {
font-family: "Noto Sans TC", sans-serif;
background: #eef3f8;
color: #222;
padding: 1em;
line-height: 1.6;
}
h1 { text-align: center; color: #005d9e; }
.section {
background: #fff;
margin: 1em auto;
padding: 1em;
border-radius: 10px;
max-width: 800px;
box-shadow: 0 0 10px rgba(0,0,0,0.05);
}
.warn {
background: #ffe8aa;
padding: 0.5em;
font-weight: bold;
color: #a00;
border-left: 5px solid #a00;
}
.map { height: 400px; margin: 1em 0; }
.activity-input { margin-top: 1em; }
.result { font-weight: bold; color: #b00; }
button { margin-top: 1em; }
</style>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
</head>
<body>

<h1>ğŸŒ€ AIé¢¨æš´æ¶ˆæ¯</h1>
<div class="section" id="date">ç‰ˆæœ¬ï¼šè¼‰å…¥ä¸­...</div>

<div class="section" id="warning">
<div class="warn" id="hkoWarning">âš ï¸ æ­£åœ¨è¼‰å…¥å¤©æ–‡å°è­¦å‘Š...</div>
</div>

<div class="section" id="forecast">
<h2>ğŸŒ¬ï¸ AI é æ¸¬è·¯å¾‘åœ–</h2>
<div id="map" class="map"></div>
<p>æœ¬åœ–é¡¯ç¤ºç”± <strong>GLO-TCTrackX</strong> æ¨¡å‹é æ¸¬çš„é¢¨æš´ç§»å‹•è·¯å¾‘ï¼ˆæœ€æ–°é æ¸¬ï¼‰ã€‚</p>
</div>

<div class="section" id="windSignal">
<h2>ğŸ“Š é¢¨çƒæ‡¸æ›æ©Ÿç‡</h2>
<ul id="windProbList"></ul>
</div>

<div class="section" id="impact">
<h2>ğŸ“… ä¸‰æ—¥å…§å½±éŸ¿æ™‚æ®µé æ¸¬</h2>
<ul id="impactInfo">
<li>è¼‰å…¥ä¸­...</li>
</ul>
</div>

<div class="section" id="activity">
<h2>ğŸƒğŸ»â€â™€ï¸ æ´»å‹•å»ºè­°åŠ©æ‰‹</h2>
<p>è«‹è¼¸å…¥ä½ çš„æ´»å‹•æ™‚é–“èˆ‡åœ°é»ï¼ˆä¾‹å¦‚ã€Œ7æœˆ18æ—¥ä¸‹åˆè¡Œå±±ã€ï¼‰ï¼š</p>
<input id="activityInput" class="activity-input" type="text" placeholder="7æœˆ18æ—¥æ—©ä¸Šä¹˜èˆ¹"/>
<button onclick="suggestActivity()">æŸ¥è©¢å»ºè­°</button>
<p id="activityResult" class="result"></p>
</div>

<div class="section" id="tide">
<h2>ğŸŒŠ é¢¨æš´æ½®é æ¸¬åœ–</h2>
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/28/Storm_surge_example.svg/640px-Storm_surge_example.svg.png" width="100%" alt="ç¤ºæ„åœ–">
<p>å¦‚éœ€æ¥å…¥å¯¦æ™‚é¢¨æš´æ½®è³‡æ–™ï¼ˆNOAAæˆ–å¤©æ–‡å°ï¼‰ï¼Œå¯ç¨å¾Œæ•´åˆã€‚</p>
</div>

<div class="section" id="voice">
<h2>ğŸ”Š èªéŸ³æç¤º</h2>
<button onclick="speak('zh')">ğŸ“¢ ç²µèªæ’­æ”¾</button>
<button onclick="speak('en')">ğŸ“¢ è‹±èªæ’­æ”¾</button>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const workerURL = "https://storm-api.ctakwah.workers.dev/aiData.json"; // è«‹æ›æˆä½ çš„ Cloudflare Worker é€£çµ

fetch(workerURL)
.then(res => res.json())
.then(aiData => {
// æ›´æ–°æ™‚é–“
document.getElementById("date").textContent =
`ç‰ˆæœ¬ï¼š${new Date(aiData.latestTime).toLocaleString("zh-HK")}`;

// å¤©æ–‡å°è­¦å‘Š
document.getElementById("hkoWarning").textContent =
`âš ï¸ ç¾æ™‚è­¦å‘Šï¼š${aiData.hkoWarning?.status || "ç„¡è³‡æ–™"}`;

// åœ°åœ–ç¹ªåœ–
const map = L.map('map').setView([22.3, 114.2], 6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
attribution: '&copy; OpenStreetMap'
}).addTo(map);

const latlngs = aiData.path.map(p => [p.lat, p.lng]);
L.polyline(latlngs, { color: 'red' }).addTo(map);

aiData.path.forEach((p, i) => {
L.circleMarker([p.lat, p.lng], {
radius: 5,
color: i === aiData.path.length - 1 ? 'blue' : 'gray'
}).addTo(map).bindPopup(
`${i === aiData.path.length - 1 ? "æœ€æ–°ä½ç½®" : `é æ¸¬é» ${i + 1}`}<br>${new Date(p.time).toLocaleString("zh-HK")}`
);
});

// æ‡¸æ›æ©Ÿç‡
aiData.hkWindBallProb.forEach(item => {
const li = document.createElement("li");
li.textContent = `${item.day}ï¼šä¸‰è™Ÿé¢¨çƒ ${item.signal3}%ã€å…«è™Ÿé¢¨çƒ ${item.signal8}%`;
document.getElementById("windProbList").appendChild(li);
});

// å½±éŸ¿æ™‚æ®µé æ¸¬
document.getElementById("impactInfo").innerHTML = `
<li>æœ€æ¥è¿‘é¦™æ¸¯æ™‚é–“ï¼š${aiData.impactForecast.closestTime}</li>
<li>æœ€å¯èƒ½æ‡¸æ›ä¸‰è™Ÿ/å…«è™Ÿä¿¡è™Ÿï¼š${aiData.impactForecast.likelySignalDay}</li>
<li>é¢¨éšªæç¤ºï¼š${aiData.impactForecast.riskComment}</li>
`;

// èªéŸ³å…§å®¹
window.voiceText = {
zh: `æ ¹æ“šAIé æ¸¬ï¼Œé¢¨æš´å°‡æ–¼ ${aiData.impactForecast.closestTime} æœ€æ¥è¿‘é¦™æ¸¯ï¼Œ${aiData.impactForecast.riskComment}`,
en: `According to AI forecast, the storm will be closest to Hong Kong around ${aiData.impactForecast.closestTime}. ${aiData.impactForecast.riskComment}`
};
})
.catch(err => {
console.error("âŒ è¼‰å…¥é¢¨æš´è³‡æ–™å¤±æ•—ï¼š", err);
document.getElementById("date").textContent = "ç‰ˆæœ¬ï¼šè³‡æ–™è¼‰å…¥å¤±æ•—";
document.getElementById("hkoWarning").textContent = "âš ï¸ ç„¡æ³•è¼‰å…¥è­¦å‘Šè³‡è¨Šã€‚";
});

function suggestActivity() {
const input = document.getElementById("activityInput").value;
const risky = /è¡Œå±±|ä¹˜èˆ¹|éœ²ç‡Ÿ|å¤–å‡º|æ´»å‹•/;
const day = input.includes("18") ? "ä¸ƒæœˆåå…«æ—¥" : "è©²æ—¥";
const result = risky.test(input)
? `âš ï¸ AIé æ¸¬${day}æœŸé–“é¢¨å‹¢è¼ƒå¤§ï¼Œå»ºè­°ä½ å»¶æœŸæˆ–æ”¹è®Šæ´»å‹•å®‰æ’ã€‚`
: `âœ… AIé æ¸¬${day}é¢¨å‹¢å°šå¯ï¼Œæ´»å‹•å¯å¦‚å¸¸é€²è¡Œã€‚`;
document.getElementById("activityResult").textContent = result;
}

function speak(lang) {
const msg = new SpeechSynthesisUtterance();
msg.lang = lang === 'zh' ? 'zh-HK' : 'en-US';
msg.text = window.voiceText?.[lang] || "æœªæœ‰é æ¸¬è³‡æ–™ã€‚";
speechSynthesis.speak(msg);
}
</script>
</body>
</html>