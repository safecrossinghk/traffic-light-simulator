<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>å³æ™‚äººæµï¼ˆpopular_timesï¼‰</title>
<style>
body { font-family: sans-serif; margin: 1em; background: #f9f9f9; }
.location { padding: 1em; margin-bottom: 1em; background: #fff; border: 1px solid #ccc; border-radius: 8px; }
h2 { font-size: 1.2em; margin: 0 0 0.5em 0; }
.value { font-weight: bold; color: #006400; }
</style>
</head>
<body>
<h1>ğŸ“ å³æ™‚äººæµï¼ˆpopular_timesï¼‰æŸ¥è©¢</h1>
<div id="results"></div>

<script>
const apiKey = 'MWE3NWNmMzFjZWNiNGMxMDlhNGNhNDFjNTY3ZjZkMTB8NzY5ZGY0MGQ0Zg'; // Outscraper API Key
const places = [
{ name: 'èƒç£è¥¿ç«™', query: 'Tsuen Wan West Station, Hong Kong' },
{ name: 'æ—ºè§’æœ—è±ªåŠ', query: 'Langham Place Mong Kok, Hong Kong' },
{ name: 'æ·±æ°´åŸ—åœ°éµç«™', query: 'Sham Shui Po MTR Station, Hong Kong' },
{ name: 'å°–æ²™å’€æµ·æ¸¯åŸ', query: 'Harbour City Tsim Sha Tsui, Hong Kong' },
{ name: 'ä¸­ç’°äº¤æ˜“å»£å ´', query: 'Exchange Square Central, Hong Kong' }
];

async function fetchPopularTimes() {
const resultsDiv = document.getElementById('results');
resultsDiv.innerHTML = ''; // æ¸…ç©º

for (const place of places) {
const url = `https://api.app.outscraper.com/maps/places/data?query=${encodeURIComponent(place.query)}&limit=1&language=en&fields=popular_times`;
try {
const response = await fetch(url, {
headers: {
'X-API-KEY': apiKey,
'accept': 'application/json'
}
});
const data = await response.json();
const item = data[0];

let now = new Date();
let weekday = now.getDay(); // Sunday = 0
let hour = now.getHours();

let popularNow = item?.popular_times?.[weekday]?.data?.[hour] ?? null;

const div = document.createElement('div');
div.className = 'location';
div.innerHTML = `
<h2>${place.name}</h2>
<p>ç›®å‰æ™‚æ®µäººæµï¼š <span class="value">${popularNow !== null ? popularNow + '%' : 'ç„¡è³‡æ–™'}</span></p>
`;
resultsDiv.appendChild(div);

if (popularNow !== null) {
speak(`${place.name}ï¼Œç¾æ™‚äººæµå¤§ç´„ ${popularNow} ç™¾åˆ†æ¯”ã€‚`, 'zh-HK');
speak(`${place.query}, current crowd level is ${popularNow} percent.`, 'en-US');
} else {
speak(`${place.name} æš«æ™‚æœªæœ‰äººæµè³‡æ–™ã€‚`, 'zh-HK');
}

} catch (error) {
console.error(error);
}
}
}

function speak(text, lang = 'zh-HK') {
const utter = new SpeechSynthesisUtterance(text);
utter.lang = lang;
utter.rate = 1;
window.speechSynthesis.speak(utter);
}

fetchPopularTimes();
setInterval(fetchPopularTimes, 5 * 60 * 1000); // æ¯ 5 åˆ†é˜æ›´æ–°
</script>
</body>
</html>