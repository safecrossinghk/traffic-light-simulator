<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>ğŸ“ å³æ™‚äººæµæŸ¥è©¢</title>
<style>
body { font-family: sans-serif; padding: 20px; }
#map { width: 100%; height: 300px; margin-top: 20px; display: none; }
.danger { color: red; font-weight: bold; }
</style>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
<h2>ğŸ“ å³æ™‚äººæµæŸ¥è©¢</h2>
<label for="place">ğŸ” æŸ¥è©¢åœ°é»é—œéµå­—ï¼š</label>
<input type="text" id="place" value="é¦™æ¸¯åœ‹éš›æ©Ÿå ´" />
<button onclick="search()">æŸ¥è©¢</button>
<div id="result" style="margin-top: 20px;"></div>
<div id="map"></div>

<script>
async function search() {
const query = document.getElementById("place").value;
document.getElementById("result").innerHTML = "â³ è«‹ç¨å€™...";
document.getElementById("map").style.display = "none";

try {
const res = await fetch("https://tiny-disk-0d7b.ctakwah.workers.dev/?query=" + encodeURIComponent(query));
const data = await res.json();
console.log("âœ… API å›å‚³ï¼š", data);

if (!data.success) {
document.getElementById("result").innerHTML = "âŒ æŸ¥è©¢å¤±æ•—ï¼š" + (data.message || "æœªçŸ¥éŒ¯èª¤");
return;
}

const pt = data.popular_times;
const location = data.location || {};
const lat = location.lat;
const lng = location.lng;

document.getElementById("result").innerHTML = `
ğŸ“ æŸ¥è©¢åœ°é»ï¼š${query}<br>
ğŸ‘¥ ç¾æ™‚äººæµï¼š<b>éå¸¸ç¹å¿™</b>ï¼ˆæ¨¡æ“¬ 95%ï¼‰<br>
${(!lat || !lng) ? '<p class="danger">âš ï¸ æ²’æœ‰ç¶“ç·¯åº¦è³‡æ–™ï¼Œåœ°åœ–ç„¡æ³•é¡¯ç¤º</p>' : ''}
`;

if (lat && lng) {
showMap(lat, lng, query);
}

console.log("ğŸ“Œ ç¶“ç·¯åº¦ï¼š", lat, lng);
} catch (e) {
document.getElementById("result").innerHTML = "âŒ ç™¼ç”ŸéŒ¯èª¤ï¼š" + e.toString();
}
}

let map;
function showMap(lat, lng, label) {
document.getElementById("map").style.display = "block";
if (!map) {
map = L.map("map").setView([lat, lng], 16);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
attribution: "Â© OpenStreetMap"
}).addTo(map);
} else {
map.setView([lat, lng], 16);
}

L.marker([lat, lng]).addTo(map)
.bindPopup("ğŸ“ " + label)
.openPopup();
}
</script>
</body>
</html>