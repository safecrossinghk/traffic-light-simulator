<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8" />
<title>å³æ™‚äººæµç‹€æ³é¡¯ç¤º</title>
<style>
body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
h1 { color: #333; }
select, button { padding: 10px; font-size: 16px; margin: 10px 0; }
#result { font-size: 18px; margin-top: 20px; }
</style>
</head>
<body>
<h1>ğŸ“ å³æ™‚äººæµç‹€æ³é¡¯ç¤ºï¼ˆOutscraper ç‰ˆæœ¬ï¼‰</h1>

<label for="location">é¸æ“‡åœ°é»ï¼š</label>
<select id="location">
<option>Lo Wu Station Hong Kong</option>
<option>Lok Ma Chau Station Hong Kong</option>
<option>Heung Yuen Wai Boundary Control Point Public Toilet (II)</option>
</select>

<br />
<label for="language">èªè¨€ï¼š</label>
<select id="language">
<option value="zh">ä¸­æ–‡</option>
<option value="en">English</option>
</select>

<br />
<button onclick="checkCrowd()">æª¢æŸ¥äººæµ</button>

<div id="result">çµæœå°‡é¡¯ç¤ºæ–¼æ­¤</div>

<audio id="audio"></audio>

<script>
async function checkCrowd() {
const place = document.getElementById("location").value;
const lang = document.getElementById("language").value;
const apiKey = "MWE3NWNmMzFjZWNiNGMxMDlhNGNhNDFjNTY3ZjZkMTB8NzY5ZGY0MGQ0Zg"; // â† æ›¿æ›ç‚ºä½ çš„é‡‘é‘°
const resultDiv = document.getElementById("result");
resultDiv.innerText = "è®€å–ä¸­...";

try {
const response = await fetch("https://api.app.outscraper.com/maps/search", {
method: "POST",
headers: {
"X-API-KEY": apiKey,
"Content-Type": "application/json"
},
body: JSON.stringify({
query: place,
limit: 1,
language: "zh-HK",
region: "hk"
})
});

const data = await response.json();
if (!data || !data[0] || !data[0].popular_times) {
resultDiv.innerText = "âš ï¸ ç„¡æ³•å–å¾—äººæµè³‡æ–™";
return;
}

const currentDay = new Date().getDay(); // Sunday = 0
const currentHour = new Date().getHours();
const todayData = data[0].popular_times.find(d => d.day === currentDay);

if (!todayData || !todayData.data[currentHour]) {
resultDiv.innerText = "âš ï¸ ä»Šæ—¥ç„¡è³‡æ–™";
return;
}

const value = todayData.data[currentHour];
let status = '';
let message = '';
let audioFile = '';

// ğŸ”„ æ ¹æ“šç™¾åˆ†æ¯”å®šç¾©äººæµç­‰ç´š
if (value < 20) {
status = 'ä¸ç¹å¿™';
message = (lang === 'zh') ? "ç›®å‰äººæµä¸ç¹å¿™ï¼Œè«‹å®‰å¿ƒå‰å¾€ã€‚" : "The area is quiet. You may proceed safely.";
audioFile = (lang === 'zh') ? "quiet_zh.mp3" : "quiet_en.mp3";
} else if (value < 60) {
status = 'æ­£å¸¸';
message = (lang === 'zh') ? "ç›®å‰äººæµæ­£å¸¸ï¼Œè«‹å®‰å¿ƒå‰å¾€ã€‚" : "Crowd level is normal. You may proceed safely.";
audioFile = (lang === 'zh') ? "normal_zh.mp3" : "normal_en.mp3";
} else {
status = 'ç¹å¿™';
message = (lang === 'zh') ? "ç¾å ´äººæµè¼ƒå¤šï¼Œè«‹æ³¨æ„ä¿æŒè·é›¢ã€‚" : "The area is crowded. Please maintain social distance.";
audioFile = (lang === 'zh') ? "crowded_zh.mp3" : "crowded_en.mp3";
}

resultDiv.innerText = `ğŸ™ï¸ ${place}\nç›®å‰äººæµï¼š${status}ï¼ˆ${value}%ï¼‰\n${message}`;

const audio = document.getElementById("audio");
audio.src = audioFile;
audio.play();

} catch (error) {
console.error("Fetch éŒ¯èª¤ï¼š", error);
resultDiv.innerText = "âŒ å–å¾—è³‡æ–™å¤±æ•—ï¼Œè«‹ç¨å¾Œé‡è©¦ã€‚";
}
}
</script>
</body>
</html>