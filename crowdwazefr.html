<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>è”æè§’äººæµï¼‹å³æ™‚å¤©æ°£èˆ‡é›¨é‡é å ±</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: sans-serif; padding: 1em; background: #e2f2f5; }
#topbar {
position: fixed;
top: 0; left: 0; right: 0;
background: #f0f0f0;
box-shadow: 0 1px 3px rgba(0,0,0,0.1);
z-index: 100;
padding: 10px;
font-size: 16px;
}
select {
width: 100%; padding: 8px;
font-size: 1em; margin: 0.5em 0;
}
iframe {
width: 100%; height: 280px;
border: none;
border-radius: 6px;
}
</style>
</head>
<body>
<div id="topbar">
<span id="winfo">ğŸŒ¤ æ­£åœ¨è®€å–å¤©æ°£è³‡æ–™...</span>
</div>

<div id="content" style="margin-top: 70px;">
<h2>ğŸ“ è”æè§’äººæµï¼‹å³æ™‚å¤©æ°£èˆ‡é›¨é‡é å ±</h2>
<select id="loc">
<option disabled selected>é¸æ“‡åœ°é»è§€å¯Ÿå€</option>
<option value="A">D1 Place One</option>
<option value="B">D2 Place Two</option>
</select>

<p>ğŸ“ åœ°é»ï¼š<span id="locname">ï¼ˆæœªé¸æ“‡ï¼‰</span></p>
<p>ğŸ“¡ æœ€æ–°å¤©æ°£ï¼š</p>
<div id="crowdInfo">ğŸ•’ è®€å–ä¸­...</div>
<div id="waze" style="margin-top:1em">
<iframe src="" id="mapFrame"></iframe>
</div>
</div>

<script>
const workerBase = "https://crowdwazefr.ctakwah.workers.dev";
const coords = {
A: [22.3378, 114.1472],
B: [22.3369, 114.1518]
};
const locNames = {
A: "D1 Place One",
B: "D2 Place Two"
};

async function loadWeather() {
const r = await fetch(`${workerBase}?mode=weather`);
const d = await r.json();

const rain = d.rainfall?.find(e => e.stationEng === "Kwai Chung");
const rainNow = rain?.max || 0;

let warn = "â˜ï¸ ç„¡ç‰¹åˆ¥é™é›¨é è­¦ã€‚";
if (rainNow > 5) warn = "ğŸŒ§ï¸ 20åˆ†é˜å¾Œå¯èƒ½æœ‰ä¸­é›¨ï¼ˆ" + rainNow + "mmï¼‰ï¼Œå»ºè­°å¸¶å‚™é›¨å…·ï¼";

document.getElementById("winfo").textContent =
`å¤©æ°£ï¼š${d.rh.temperature}Â°Cï¼Œæ¿•åº¦ ${d.rh.humidity}%ã€‚${warn}`;
}

async function loadCrowd(loc) {
const r = await fetch(`${workerBase}?mode=crowd&location=${loc}`);
const d = await r.json();
document.getElementById("crowdInfo").innerHTML = `ğŸš¦ç›®å‰äººæµæƒ…æ³ï¼š<b>${d.status}</b>`;
}

document.getElementById("loc").addEventListener("change", e => {
const loc = e.target.value;
document.getElementById("locname").textContent = locNames[loc];
document.getElementById("mapFrame").src = `https://embed.waze.com/iframe?zoom=16&lat=${coords[loc][0]}&lon=${coords[loc][1]}&pin=1`;
loadCrowd(loc);
});

loadWeather();
</script>
</body>
</html>