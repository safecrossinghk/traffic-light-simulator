<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<title>AIé¢¨æš´æ¶ˆæ¯</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Leaflet & Chart.js -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; }
#map { height: 50vh; }
#chart { width:100%; height:300px; }
#activity { margin:1em; }
#advice { margin:1em; font-size:1.1em; }
</style>
</head>
<body>

<h1 style="text-align:center; margin:1em 0;">AIé¢¨æš´æ¶ˆæ¯</h1>
<div id="map"></div>
<canvas id="chart"></canvas>

<div id="activity">
<h3>ğŸ“… åŠ å…¥ä½ çš„æ´»å‹•æ™‚é–“èˆ‡åœ°é»</h3>
<label>æ—¥æœŸï¼æ™‚é–“ï¼š <input type="datetime-local" id="actTime"></label><br>
<label>åœ°é»ï¼ˆå¦‚ï¼šè§€å¡˜ã€é•·æ´²ï¼‰ï¼š <input type="text" id="actLoc"></label><br>
<button id="checkBtn">åˆ†æå»ºè­°</button>
</div>
<div id="advice"></div>

<!-- Libraries -->
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// ç¯„ä¾‹ï¼šåˆæˆ JSON æª”åŒ…å«è·¯å¾‘ã€æ©Ÿç‡è³‡æ–™ï¼Œå¯¦éš›ä½¿ç”¨æ™‚ç”±å¤–éƒ¨æ›´æ–°
const aiData = {
ecmwfPoints: [
{time:"2025-07-17T09:00Z", lat:16.2, lng:125.3},
{time:"2025-07-18T09:00Z", lat:17.3, lng:121.8},
{time:"2025-07-19T09:00Z", lat:19.0, lng:118.0},
{time:"2025-07-20T09:00Z", lat:21.0, lng:115.0}
],
hkWindBallProb: [
{time:"2025-07-17T09:00Z", p3:0.05, p8:0.01},
{time:"2025-07-18T09:00Z", p3:0.30, p8:0.10},
{time:"2025-07-19T09:00Z", p3:0.60, p8:0.35},
{time:"2025-07-20T09:00Z", p3:0.80, p8:0.55}
]
};

// åœ°åœ–åˆå§‹åŒ–
const map = L.map('map').setView([20, 120], 5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
attribution: '&copy; OpenStreetMap'
}).addTo(map);

// ç¹ªè£½ AI ECMWF è·¯å¾‘
const latlngs = aiData.ecmwfPoints.map(p => [p.lat, p.lng]);
const polyline = L.polyline(latlngs, {color:'red'}).addTo(map);

// ç¹ªè£½æ™‚é–“æ¨™è¨˜èˆ‡ HK æ¨™è¨˜
aiData.ecmwfPoints.forEach(p => {
L.circleMarker([p.lat, p.lng], {radius:5, color:'red'}).bindPopup(p.time).addTo(map);
});
L.marker([22.3,114.2]).bindPopup('é¦™æ¸¯').addTo(map);
map.fitBounds(polyline.getBounds());

// æ©Ÿç‡åœ–
const ctx = document.getElementById('chart').getContext('2d');
new Chart(ctx, {
type: 'line',
data: {
labels: aiData.hkWindBallProb.map(p => p.time),
datasets: [
{label:'æ›ä¸‰è™Ÿé¢¨çƒæ©Ÿç‡', data:aiData.hkWindBallProb.map(p=>p.p3*100), borderColor:'orange', fill:false},
{label:'æ›å…«è™Ÿé¢¨çƒæ©Ÿç‡', data:aiData.hkWindBallProb.map(p=>p.p8*100), borderColor:'red', fill:false}
]
},
options: {
scales: { y:{ beginAtZero:true, max:100, ticks:{callback: v=>v + '%'} } },
plugins: { title:{ display:true, text:'é¦™æ¸¯é¢¨çƒæ‡¸æ›æ©Ÿç‡ (%)' } }
}
});

// æ´»å‹•åˆ†æåŠŸèƒ½
function checkActivity() {
const t = new Date(document.getElementById('actTime').value);
const loc = document.getElementById('actLoc').value.trim();
if (!t || !loc) {
alert('è«‹è¼¸å…¥æ—¥æœŸæ™‚é–“èˆ‡åœ°é»');
return;
}
const item = aiData.hkWindBallProb.find(p => new Date(p.time).getTime() === t.getTime());
const prob = item ? (item.p3 + item.p8) : 0;
let msg = `ä½ å®‰æ’æ–¼ ${t.toLocaleString()} åœ¨ã€Œ${loc}ã€é€²è¡Œæ´»å‹•ã€‚`;
if (prob > 0.5) {
msg += ' âš ï¸ é¢¨çƒæ©Ÿç‡è¼ƒé«˜ï¼Œä¸å»ºè­°åœ¨è©²æ™‚æ®µæˆ¶å¤–é€²è¡Œè©²æ´»å‹•ã€‚';
} else {
msg += ' ğŸ‘ é¢¨çƒæ©Ÿç‡è¼ƒä½ï¼Œå¯è€ƒæ…®ç…§å¸¸é€²è¡Œã€‚';
}
document.getElementById('advice').innerText = msg;
}
document.getElementById('checkBtn').addEventListener('click', checkActivity);
</script>

</body>
</html>
