<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>å³æ™‚äººæµæŸ¥è©¢ï¼ˆäº”åœ°é»ï¼‰</title>
<style>
body { font-family: sans-serif; padding: 20px; }
.location { margin-bottom: 20px; border-bottom: 1px solid #ccc; padding-bottom: 10px; }
.status { font-weight: bold; }
</style>
</head>
<body>
<h2>ğŸ“ å³æ™‚äººæµæŸ¥è©¢ï¼ˆ5å€‹ç†±é–€åœ°é»ï¼‰</h2>
<div id="results"></div>

<script>
const locations = [
"èƒç£è¥¿ç«™",
"æ—ºè§’æœ—è±ªåŠ",
"æ·±æ°´åŸ—åœ°éµç«™",
"å°–æ²™å’€æµ·æ¸¯åŸ",
"ä¸­ç’°äº¤æ˜“å»£å ´"
];

const API_KEY = "MWE3NWNmMzFjZWNiNGMxMDlhNGNhNDFjNTY3ZjZkMTB8NzY5ZGY0MGQ0Zg";

async function fetchCrowd(place) {
const url = `https://api.app.outscraper.com/maps/search-v2?query=${encodeURIComponent(place)}&limit=1&language=zh&region=hk`;
const res = await fetch(url, {
method: "GET",
headers: {
"X-API-KEY": API_KEY
}
});
const data = await res.json();
const result = data.data?.[0]?.[0];
if (!result || !result.popular_times) throw new Error("æœªèƒ½å–å¾— popular_times è³‡æ–™");
return result.popular_times;
}

function speak(text, lang) {
const utterance = new SpeechSynthesisUtterance(text);
utterance.lang = lang;
window.speechSynthesis.speak(utterance);
}

async function displayAll() {
const resultDiv = document.getElementById("results");
for (const place of locations) {
const el = document.createElement("div");
el.className = "location";
el.innerHTML = `<h3>${place}</h3><div class="status">ğŸ”„ è¼‰å…¥ä¸­â€¦</div>`;
resultDiv.appendChild(el);

try {
const data = await fetchCrowd(place);
const today = new Date().getDay();
const weekday = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][today];
const hour = new Date().getHours();
const todayData = data[weekday]?.[hour];

const status = todayData !== undefined
? `ç¾æ™‚äººæµï¼š${todayData}%`
: "ğŸ” æ‰¾ä¸åˆ°å³æ™‚äººæµè³‡æ–™";

el.querySelector(".status").innerText = status;

// èªéŸ³æ’­å ±
const lang = navigator.language.startsWith("zh") ? "zh-HK" : "en-US";
const spokenText = lang === "zh-HK"
? `${place} ç¾æ™‚äººæµä¿‚ ${todayData || "ç„¡è³‡æ–™"} ç™¾åˆ†æ¯”`
: `Current crowd level at ${place} is ${todayData || "not available"} percent.`;
speak(spokenText, lang);
} catch (e) {
el.querySelector(".status").innerText = "âš ï¸ æŸ¥è©¢å¤±æ•—ï¼š" + e.message;
}
}
}

// é¡å¤–åŠŸèƒ½ï¼šæª¢æŸ¥å“ªäº›åœ°é»æœ‰ popular_times è³‡æ–™
async function checkAvailability() {
console.log("ğŸ” é–‹å§‹æª¢æŸ¥å„åœ°é»æœ‰ç„¡å³æ™‚äººæµè³‡æ–™...");
for (let place of locations) {
try {
const pt = await fetchCrowd(place);
const hasData = Array.isArray(pt) && pt.length > 0;
console.log(`${place} â†’ popular_times ${hasData ? "âœ… æœ‰è³‡æ–™" : "âŒ ç„¡è³‡æ–™"}`);
} catch (e) {
console.log(`${place} â†’ âš ï¸ æŸ¥è©¢å¤±æ•—ï¼š${e.message}`);
}
}
}

// åŸ·è¡Œé¡¯ç¤ºèˆ‡æª¢æŸ¥
displayAll().then(() => checkAvailability());
</script>
</body>
</html>