<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>å³æ™‚äººæµæŸ¥è©¢</title>
<style>
body { font-family: sans-serif; padding: 10px; background: #f0f0f0; }
h2 { color: #333; }
.location { background: #fff; margin: 10px 0; padding: 10px; border-radius: 8px; }
.crowd-level { font-weight: bold; color: #007BFF; }
@media (max-width: 600px) {
h2 { font-size: 1.2em; }
.location { font-size: 0.95em; }
}
</style>
</head>
<body>
<h2>ğŸ“ å³æ™‚äººæµæŸ¥è©¢ï¼ˆæ¯5åˆ†é˜æ›´æ–°ï¼‰</h2>
<div id="locations"></div>

<script>
const API_KEY = "MWE3NWNmMzFjZWNiNGMxMDlhNGNhNDFjNTY3ZjZkMTB8NzY5ZGY0MGQ0Zg";
const places = [
{ name: "èƒç£è¥¿ç«™", query: "Tsuen Wan West Station, Hong Kong" },
{ name: "æ—ºè§’æœ—è±ªåŠ", query: "Langham Place, Mong Kok, Hong Kong" },
{ name: "æ·±æ°´åŸ—åœ°éµç«™", query: "Sham Shui Po MTR Station, Hong Kong" },
{ name: "å°–æ²™å’€æµ·æ¸¯åŸ", query: "Harbour City, Tsim Sha Tsui, Hong Kong" },
{ name: "ä¸­ç’°äº¤æ˜“å»£å ´", query: "Exchange Square, Central, Hong Kong" }
];

async function fetchCrowdData() {
document.getElementById('locations').innerHTML = 'ğŸ”„ æ­£åœ¨è¼‰å…¥...';
const results = await Promise.all(places.map(async (place) => {
try {
const res = await fetch("https://api.app.outscraper.com/places/data", {
method: "POST",
headers: {
"Content-Type": "application/json",
"X-API-KEY": API_KEY
},
body: JSON.stringify({ query: place.query })
});
const data = await res.json();
const info = data[0] || {};
const popular = info.popular_times || {};
const today = new Date().getDay();
const hour = new Date().getHours();
const crowd = (popular[today]?.[hour]) || "æœªçŸ¥";

return { name: place.name, level: crowd };
} catch (e) {
return { name: place.name, level: "è³‡æ–™éŒ¯èª¤" };
}
}));

render(results);
speakResults(results);
}

function render(data) {
document.getElementById('locations').innerHTML = data.map(d => `
<div class="location">
<div>ğŸ“ <strong>${d.name}</strong></div>
<div>ğŸ‘¥ å³æ™‚äººæµï¼š<span class="crowd-level">${d.level}</span></div>
</div>
`).join('');
}

function speakResults(data) {
const now = new Date();
const hour = now.getHours().toString().padStart(2, '0');
const min = now.getMinutes().toString().padStart(2, '0');

const zhText = `ç¾åœ¨æ™‚é–“ï¼š${hour}é»${min}åˆ†ã€‚` +
data.map(d => `${d.name}äººæµæ˜¯${d.level}ã€‚`).join('');

const enText = `Current time: ${hour}:${min}. ` +
data.map(d => `Crowd level at ${d.name} is ${d.level}.`).join(' ');

speak(zhText, 'zh-HK');
setTimeout(() => speak(enText, 'en-US'), 5000);
}

function speak(text, lang) {
const utter = new SpeechSynthesisUtterance(text);
utter.lang = lang;
utter.rate = 1;
speechSynthesis.speak(utter);
}

fetchCrowdData();
setInterval(fetchCrowdData, 5 * 60 * 1000); // æ¯ 5 åˆ†é˜æ›´æ–°
</script>
</body>
</html>
