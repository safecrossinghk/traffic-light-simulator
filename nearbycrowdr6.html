<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8">
  <title>é™„è¿‘åœ°é»äººæµæƒ…æ³</title>
</head>
<body>
  <h2>ğŸ“ é™„è¿‘åœ°é»äººæµæƒ…æ³</h2>
  <div id="results"></div>

  <script>
    const apiKey = "MWE3NWNmMzFjZWNiNGMxMDlhNGNhNDFjNTY3ZjZkMTB8NzY5ZGY0MGQ0Zg"; // ğŸ›  è«‹æ›¿æ›ç‚ºä½ çš„ Outscraper API é‡‘é‘°

    async function fetchNearbyPopularity(lat, lng) {
      const encoded = encodeURIComponent(`${lat},${lng}`);
      const url = `https://api.app.outscraper.com/maps/search-v2?query=${encoded}&limit=5`;

      try {
        const response = await fetch(url, {
          headers: { "X-API-KEY": apiKey }
        });
        const data = await response.json();
        const results = document.getElementById('results');

        if (data.length === 0) {
          results.innerHTML = "<p>âš ï¸ ç„¡åœ°é»è³‡æ–™</p>";
          return;
        }

        data.forEach(place => {
          const popularity = place?.popular_times?.[new Date().getDay()]?.data?.[new Date().getHours()];
          const p = document.createElement('p');
          p.textContent = `${place.title}ï¼š${popularity !== undefined ? `ç›®å‰äººæµ ${popularity}` : "åƒ…æä¾›æ­·å²äººæµè³‡æ–™"}`;
          results.appendChild(p);
        });
      } catch (e) {
        document.getElementById('results').innerHTML = "<p>âš ï¸ è³‡æ–™ç²å–å¤±æ•—</p>";
      }
    }

    navigator.geolocation.getCurrentPosition(pos => {
      const lat = pos.coords.latitude;
      const lng = pos.coords.longitude;
      fetchNearbyPopularity(lat, lng);
    }, err => {
      document.getElementById('results').innerHTML = "<p>âš ï¸ ç„¡æ³•å–å¾— GPS ä½ç½®</p>";
    });
  </script>
</body>
</html>