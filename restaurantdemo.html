<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>é¦™æ¸¯é¤å»³å³æ™‚äººæµ + å ‚é£Ÿç­‰å€™æ™‚é–“</title>
<style>
body { font-family: sans-serif; padding: 1em; background: #f8f8f8; }
h2 { color: #d40000; }
.restaurant { background: white; padding: 1em; margin: 1em 0; border-radius: 8px; box-shadow: 0 0 4px rgba(0,0,0,0.1); }
.status { font-weight: bold; font-size: 1.2em; color: #333; }
</style>
</head>
<body>
<h2>ğŸœ é¦™æ¸¯é¤å»³å³æ™‚äººæµ + å ‚é£Ÿç­‰å€™æ™‚é–“é ä¼°</h2>
<div id="results">è¼‰å…¥ä¸­...</div>

<script>
const restaurants = [
{ name: "è­šä»”ä¸‰å“¥ï¼ˆå°–æ²™å’€ï¼‰", query: "è­šä»”ä¸‰å“¥ å°–æ²™å’€" },
{ name: "ç¨»é¦™è¶…ç´šæ¼æ¸¯ï¼ˆæ—ºè§’ï¼‰", query: "ç¨»é¦™ æ—ºè§’" },
{ name: "é‡‘è¨˜å†°å®¤ï¼ˆéŠ…é‘¼ç£ï¼‰", query: "é‡‘è¨˜å†°å®¤ éŠ…é‘¼ç£" },
{ name: "ä¹è¨˜ç‰›è…©ï¼ˆä¸­ç’°ï¼‰", query: "ä¹è¨˜ç‰›è…© ä¸­ç’°" },
{ name: "å¤§å®¶æ¨‚ï¼ˆæ²™ç”°ï¼‰", query: "å¤§å®¶æ¨‚ æ²™ç”°" }
];

// æ¨ç®—å ‚é£Ÿç­‰ä½æ™‚é–“é‚è¼¯ï¼ˆæ‹‰é—Šç‰ˆï¼‰
function estimateWait(popularity) {
if (popularity <= 40) return "ç„¡éœ€ç­‰ä½";
if (popularity <= 60) return "ç´„ 10â€“20 åˆ†é˜";
if (popularity <= 75) return "ç´„ 20â€“30 åˆ†é˜";
if (popularity <= 85) return "ç´„ 30â€“45 åˆ†é˜";
if (popularity <= 95) return "ç´„ 45â€“60 åˆ†é˜";
return "å¯èƒ½è¶…é 1 å°æ™‚";
}

// ä½¿ç”¨ä¸­è½‰çš„ Cloudflare Worker APIï¼ˆé¿å…æ´©æ¼ API é‡‘é‘°ï¼‰
async function fetchData(query) {
const res = await fetch("https://crowd-api-demo.ctakwah.workers.dev/?query=" + encodeURIComponent(query));
const data = await res.json();
return data;
}

// ç²µèªèªéŸ³æ’­å ±
function speak(text) {
const utter = new SpeechSynthesisUtterance(text);
utter.lang = 'zh-HK';
speechSynthesis.speak(utter);
}

// ä¸»æ›´æ–°å‡½æ•¸
async function update() {
const container = document.getElementById("results");
container.innerHTML = "";

for (const r of restaurants) {
const data = await fetchData(r.query);
const popularity = data.popularity || 0;
const waitTime = estimateWait(popularity);
const html = `
<div class="restaurant">
<div><strong>${r.name}</strong></div>
<div class="status">ğŸ‘¥ å³æ™‚äººæµï¼š${popularity}%</div>
<div class="status">â±ï¸ å ‚é£Ÿç­‰å€™æ™‚é–“é ä¼°ï¼š${waitTime}</div>
</div>
`;
container.innerHTML += html;

// ç²µèªèªéŸ³æ’­å ±å…§å®¹
speak(`${r.name}ï¼Œäººæµ ${popularity} ç™¾åˆ†æ¯”ï¼Œå ‚é£Ÿé è¨ˆç­‰ä½ ${waitTime}`);
}
}

update(); // åˆæ¬¡è¼‰å…¥
setInterval(update, 300000); // æ¯ 5 åˆ†é˜æ›´æ–°ä¸€æ¬¡
</script>
</body>
</html>