<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<!-- åŒä¸Šç•¥ï¼Œåªä¿ç•™æ ¸å¿ƒ -->
</head>
<body>
<div class="container">
<div class="card">
<div id="updateTime">ç‰ˆæœ¬ï¼šè¼‰å…¥ä¸­...</div>
<div class="warn" id="hkWarn">âš ï¸ è¼‰å…¥å¤©æ–‡å°è­¦å‘Šä¸­...</div>
</div>
<div class="card">
<h2>ğŸŒ€ AI é æ¸¬è·¯å¾‘åœ–</h2>
<div id="map" style="height:300px;"></div>
</div>
<!-- å…¶å®ƒå€å¡Šç•¥ -->
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const HKO_WARN_API = 'https://data.weather.gov.hk/weatherAPI/opendata/weather.php?dataType=warnsum&lang=tc';
const AURORA_API = '/aurora-data.json'; // Worker æ ¹ URL

async function loadAll() {
// CORS æ³¨ï¼šæ­¤ç‚º Worker å…§ fetchï¼Œä¸éœ€è€ƒæ…®å®¢æˆ¶ç«¯é™åˆ¶
document.getElementById('map').style.filter = 'blur(5px)';

const [auroraRes, hkoRes] = await Promise.all([
fetch(AURORA_API),
fetch(HKO_WARN_API)
]);

const hko = await hkoRes.json();
document.getElementById('hkWarn').innerText = `âš ï¸ ç¾æ™‚è­¦å‘Šï¼š${hko.details||'ç„¡è­¦å‘Š'}`;

if (!auroraRes.ok) {
document.getElementById('updateTime').innerText = 'ç‰ˆæœ¬è¼‰å…¥å¤±æ•—';
return;
}
const data = await auroraRes.json();
document.getElementById('updateTime').innerText = `ç‰ˆæœ¬ï¼š${data.update_time}`;

const coords = data.forecast.map(p => [p.lat, p.lon]);
const map = L.map('map').setView(coords[0], 6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
L.polyline(coords, { color: 'red'}).addTo(map);
L.marker(coords.at(-1)).addTo(map).bindPopup('æœ€æ–°ä½ç½®').openPopup();

document.getElementById('map').style.filter = 'none';
}

loadAll();
</script>
</body>
</html>